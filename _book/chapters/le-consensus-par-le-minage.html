<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Consensus Through Mining – L'Élégance de Bitcoin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/la-resistance-a-la-censure.html" rel="next">
<link href="../chapters/la-valeur-de-l-information.html" rel="prev">
<link href="..//figures/freestarfish.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="8&nbsp; Consensus Through Mining – L’Élégance de Bitcoin">
<meta property="og:description" content="">
<meta property="og:image" content="cover.png">
<meta property="og:site_name" content="L'Élégance de Bitcoin">
<meta name="twitter:title" content="8&nbsp; Consensus Through Mining – L’Élégance de Bitcoin">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="cover.png">
<meta name="twitter:site" content="@konsensusn">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">L’Élégance de Bitcoin</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-book" role="img" aria-label="Book">
</i> 
<span class="menu-text">Lire en ligne</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bitcoinbook.shop/products/lelegance-de-bitcoin"> <i class="bi bi-shop" role="img" aria-label="Shop">
</i> 
<span class="menu-text">Acheter ce livre!</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/le-consensus-par-le-minage.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Consensus Through Mining</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main">
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos de ce livre</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface-de-jacques-favier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface by Jacques Favier</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/remerciements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/avant-propos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-debuts-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Beginnings of Bitcoin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/une-croissance-conflictuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Conflict-Ridden Growth</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/des-racines-monetaires.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Monetary Roots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-necessite-de-decentralisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Necessity of Decentralization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/un-mouvement-technologique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un mouvement technologique</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-cybermonnaie-avant-nakamoto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cryptocurrency Before Nakamoto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-valeur-de-l-information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Value of Information</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-consensus-par-le-minage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Consensus Through Mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-resistance-a-la-censure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Resistance to Censorship</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-changement-de-la-monnaie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Evolution of Currency</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-determination-du-protocole.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Determining the Protocol</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-rouages-de-la-machine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Inner Workings of the Machine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-contrats-autonomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Autonomous Contracts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-passage-a-l-echelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling Up</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/l-avenir-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The Future of Bitcoin</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#le-problème-des-généraux-byzantins" id="toc-le-problème-des-généraux-byzantins" class="nav-link active" data-scroll-target="#le-problème-des-généraux-byzantins">The Byzantine Generals Problem</a></li>
  <li><a href="#la-preuve-de-travail" id="toc-la-preuve-de-travail" class="nav-link" data-scroll-target="#la-preuve-de-travail">Proof of Work</a></li>
  <li><a href="#la-chaîne-de-blocs" id="toc-la-chaîne-de-blocs" class="nav-link" data-scroll-target="#la-chaîne-de-blocs">The Blockchain</a>
  <ul class="collapse">
  <li><a href="#block-version" id="toc-block-version" class="nav-link" data-scroll-target="#block-version">Block Version</a></li>
  <li><a href="#previous-block-identifier" id="toc-previous-block-identifier" class="nav-link" data-scroll-target="#previous-block-identifier">Previous Block Identifier</a></li>
  <li><a href="#merkle-root" id="toc-merkle-root" class="nav-link" data-scroll-target="#merkle-root">Merkle Root</a></li>
  <li><a href="#timestamp" id="toc-timestamp" class="nav-link" data-scroll-target="#timestamp">Timestamp</a></li>
  <li><a href="#target-value" id="toc-target-value" class="nav-link" data-scroll-target="#target-value">Target Value</a></li>
  <li><a href="#nonce" id="toc-nonce" class="nav-link" data-scroll-target="#nonce">Nonce</a></li>
  </ul></li>
  <li><a href="#le-revenu-du-minage" id="toc-le-revenu-du-minage" class="nav-link" data-scroll-target="#le-revenu-du-minage">Mining Revenue</a></li>
  <li><a href="#la-chaîne-la-plus-longue" id="toc-la-chaîne-la-plus-longue" class="nav-link" data-scroll-target="#la-chaîne-la-plus-longue">The Longest Chain</a></li>
  <li><a href="#la-résistance-à-la-double-dépense" id="toc-la-résistance-à-la-double-dépense" class="nav-link" data-scroll-target="#la-résistance-à-la-double-dépense">Resistance to Double Spending</a></li>
  <li><a href="#lindustrie-minière" id="toc-lindustrie-minière" class="nav-link" data-scroll-target="#lindustrie-minière">The Mining Industry</a></li>
  <li><a href="#un-algorithme-de-consensus-novateur" id="toc-un-algorithme-de-consensus-novateur" class="nav-link" data-scroll-target="#un-algorithme-de-consensus-novateur">An Innovative Consensus Algorithm</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="ch:confirmation" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Consensus Through Mining</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><span id="enotezch:8" label="enotezch:8"></span></p>
<p><span class="lettrine">B</span><span class="smallcaps">i</span>itcoin is a decentralized model of digital currency originating from distributed computing—a discipline that developed alongside the emergence of the internet. Specifically, it is based on a peer-to-peer network of computers in which all participants share identical responsibilities. As such, it constitutes a <em>peer-to-peer electronic cash system</em>.</p>
<p>The central challenge of Bitcoin thus lies in reaching agreement on the contents of a ledger that determines who owns what—that is, achieving consensus on the ownership of units. Establishing such agreement, in particular, resolves the double-spending problem that arises in the digital world due to the ease of data replication.</p>
<p>Reaching consensus—unanimous agreement within a group—is not easily accomplished among humans. Social conciliation may work for general rules but is ill-suited for specific details. Consequently, human organizations often have to rely on a central authority tasked with making decisions.</p>
<p>Bitcoin is specifically designed to avoid the need for a trusted third party. To achieve this, it employs a distributed and open consensus mechanism based on an activity commonly known as mining, where the confirmation of transactions—their inclusion in the ledger—is ensured through a process called proof of work. In this chapter, we will delve into the functioning of this innovative consensus algorithm.</p>
<section id="le-problème-des-généraux-byzantins" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="le-problème-des-généraux-byzantins">The Byzantine Generals Problem</h2>
<p>The issue of consensus is illustrated by the Byzantine Generals Problem, a distributed computing problem formalized in 1982 by Leslie Lamport, Robert Shostak, and Marshall Pease<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This problem addresses the challenge of unreliable communications and participant integrity in distributed systems, applying to cases where components of a computer system need to agree.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Leslie Lamport, Robert Shostak, Marshall Pease, “The Byzantine Generals Problem,” in <em>ACM Trans. Program. Lang. Syst.</em>, vol.&nbsp;4, no.&nbsp;3, 1982, pp.&nbsp;382–401: <a href="https://lamport.azurewebsites.net/pubs/byz.pdf" class="uri">https://lamport.azurewebsites.net/pubs/byz.pdf</a>.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;According to Leslie Lamport, the term “Byzantine” was chosen to avoid offending the reader’s patriotic sentiment (since the army in the metaphor includes traitors), as this term was applied <em>after the fact</em> by historians, and the Byzantines themselves considered themselves Roman. — See Leslie Lamport, <em>My Writings</em>: <a href="http://lamport.azurewebsites.net/pubs/pubs.html#byz" class="uri">http://lamport.azurewebsites.net/pubs/pubs.html#byz</a>.</p></div></div><p>The problem is presented as a metaphor involving generals of the Byzantine army—the Eastern Roman Empire that lasted until 1453 following the fall of its western counterpart in 476<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. These generals are besieging an enemy city with their troops, aiming to attack it. They can communicate only through orally relayed messages and must find a way to establish a common battle plan using this method. For instance, the generals may seek to coordinate an attack at dawn, sharing their intentions by sending the message “attack” to confirm the assault, or “retreat” to cancel it.</p>
<p>However, a small number of these generals turn out to be traitors working for the enemy, attempting to sow confusion within the army. These traitors send contradictory messages to their counterparts to ensure that some loyal generals attack while others retreat at the moment of assault, leading to certain defeat, as illustrated in Figure&nbsp;<a href="#fig:byzantine-generals-attack" data-reference-type="ref" data-reference="fig:byzantine-generals-attack">8.1</a>.</p>
<div id="fig:byzantine-generals-attack" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/byzantine-generals-attack.png" class="img-fluid figure-img"></p>
<figcaption>Attack of the Byzantine generals on the city: success and failure.</figcaption>
</figure>
</div>
<p>The problem is to find a strategy (i.e., an algorithm) that ensures all loyal generals agree on the battle plan. The traitors will then retreat, but since their number is assumed to be limited, the attack will still succeed.</p>
<p>The situation makes achieving consensus difficult. Appointing a commander to whom subordinate generals would obey is not feasible because the commander could be a traitor. Lamport, Shostak, and Pease demonstrated that the problem can be solved absolutely if and only if the loyal generals represent more than two-thirds of all generals<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>; in other words, there cannot be more than one-third traitors within the army.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;This property is demonstrated in Lamport et al.’s original article. The more precise condition is <span class="math inline">\(n \ge 3 m + 1\)</span>, where <span class="math inline">\(n\)</span> is the total number of generals and <span class="math inline">\(m\)</span> the number of traitors.</p></div></div><p>The metaphor of the Byzantine generals directly applies to distributed systems—that is, systems whose components are separated and must communicate to synchronize. The generals represent system components, the traitors represent faulty components, and the messages are data transmitted between components. The goal is to obtain an algorithm that can detect failures, known as Byzantine faults, and allow the other components to exclude them. The resulting resilience is called Byzantine Fault Tolerance (BFT); the system is said to be BFT-compliant.</p>
<p>Initially, the problem was described for computer systems relying on components located in different places, where reliable data transmission is critical, such as aerospace and aviation systems<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. But it also concerns (and is of interest to us here) peer-to-peer systems based on a horizontal network of participants, particularly crypto-economic systems like Bitcoin, where network nodes need to agree on the contents of a ledger. The objective is then to find an algorithm that allows all honest nodes to reach consensus in the presence of malicious (or “Byzantine”) nodes.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;The Boeing 777’s infrastructure relies notably on the ARINC 629 data bus, which quadruple-replicates sent messages to ensure a result with minimal latency. — Elaine Ou, “Byzantine Fault Tolerant Airplanes,” February 12, 2017: <a href="https://elaineou.com/2017/02/12/byzantine-fault-tolerant-airplanes/" class="uri">https://elaineou.com/2017/02/12/byzantine-fault-tolerant-airplanes/</a>.</p></div></div><p>Before Bitcoin, the problem was solved using so-called “classical” algorithms based on the ideas of Lamport, Shostak, and Pease. The most well-known is probably the PBFT (Practical Byzantine Fault Tolerance) consensus algorithm, developed by Miguel Castro and Barbara Liskov in 1999, which allowed a given number of participants to agree while handling thousands of requests per second with latency under a millisecond.</p>
<p>Long before Bitcoin, Wei Dai and Nick Szabo considered using this type of algorithm for their electronic money systems, b-money and bit gold. Similarly, many crypto-economic systems still employ them today for performance reasons, such as Ethereum, whose consensus is based on the Casper FFG algorithm.</p>
<p>However, these algorithms impose strong constraints: nodes must know all other nodes and must communicate with each other. As a result, nodes authorized to participate in the consensus must be selected before the algorithm is launched, usually through Proof of Authority (PoA) using a whitelist of nodes, or Proof of Stake (PoS) based on the amount of units owned or delegated. This implies less robustness because validators are known to everyone and are therefore more exposed to attacks.</p>
<p>Bitcoin addresses this problem differently, using a new type of algorithm: Nakamoto’s consensus algorithm based on proof of work. This method is more robust in the sense that network nodes do not need to know all other nodes, and no identification is required.</p>
<p>Since Bitcoin’s primary role is the transfer of value, the goal is to agree on who owns what—that is, the <em>state</em> of the system. Satoshi Nakamoto’s proposed solution involves using a ledger recording all transactions made since the system’s launch: “The only way to confirm the absence of a transaction is to be aware of all transactions<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.” This ledger, forming the system’s <em>history</em>, is organized as a succession of blocks of transactions, such that it is commonly called the <em>blockchain</em>. Network nodes each maintain a complete copy of the chain, transmitting its elements upon request.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>New blocks are added to the chain regularly through the production of a proof of work. The actors performing this operation are called miners. Network nodes reach consensus by considering the longest chain as the correct one. Thus, as Satoshi Nakamoto wrote:</p>
<p>“The proof-of-work chain is a solution to the Byzantine Generals Problem<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Satoshi Nakamoto, “Re: Bitcoin P2P e-cash paper,” November 13, 2008, 22:56:55 UTC: <a href="https://www.metzdowd.com/pipermail/cryptography/2008-November/014849.html" class="uri">https://www.metzdowd.com/pipermail/cryptography/2008-November/014849.html</a>.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;More precisely, it sacrifices some of the security property in Lamport’s sense to improve Byzantine fault tolerance.</p></div></div><p>The innovative aspect of this algorithm is that it solves the problem probabilistically rather than absolutely<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Consequently, transactions included in the ledger are never strictly final but are considered such after a certain time, probabilistically speaking. This functioning requires only 51% honest validators, instead of the 67% required by classical algorithms.</p>
</section>
<section id="la-preuve-de-travail" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="la-preuve-de-travail">Proof of Work</h2>
<p>Proof of Work (PoW) is a process that allows a computing device to objectively and quantifiably demonstrate that it has expended energy. This method is used to select computers for access to a service or privilege.</p>
<p>Proof of Work is a mechanism against Sybil attacks, making it difficult for an actor to create excessive identities to take control of the network. A Sybil attack is one where, in an open network based on a reputation system, profiles are duplicated cheaply to disrupt operations. This is a particularly prevalent issue on social media, where bot accounts are mass-created to boost the visibility of specific content.</p>
<p>The concept of Proof of Work was first described by Cynthia Dwork and Moni Naor in 1992, in an article presenting a method to combat spam in email inboxes<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>. The term “proof of work” was introduced in 1999 by Markus Jakobsson and Ari Juels<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Cynthia Dwork, Moni Naor, “Pricing via Processing or Combatting Junk Mail,” 1992.</p></div><div id="fn9"><p><sup>9</sup>&nbsp;Markus Jakobsson, Ari Juels, “Proofs of Work and Bread Pudding Protocols (Extended Abstract),” 1999.</p></div><div id="fn10"><p><sup>10</sup>&nbsp;Adam Back, “[ANNOUNCE] hash cash postage implementation,” March 28, 1997, 16:52:26 UTC: <a href="https://cypherpunks.venona.com/date/1997/03/msg00774.html" class="uri">https://cypherpunks.venona.com/date/1997/03/msg00774.html</a>; Adam Back, “Hashcash — A Denial of Service Counter-Measure,” August 1, 2002: <a href="http://www.hashcash.org/hashcash.pdf" class="uri">http://www.hashcash.org/hashcash.pdf</a>.</p></div></div><p>Dwork and Naor’s idea was implemented by British cypherpunk Adam Back in 1997 with Hashcash, an algorithm that easily produces proofs of work using a hash function, mainly intended for email<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. This implementation was later incorporated into Hal Finney’s reusable proof-of-work (RPOW) system implemented in 2004.</p>
<p>Hashcash’s Proof-of-Work algorithm involves finding a partial collision of the chosen hash function—that is, obtaining two messages whose hashes start with the same data bits. Starting from version 1.0 released in 2002, the goal is more precisely to find a partial collision for the zero hash, meaning finding a preimage whose hash starts with a determined number of binary zeros. Since the hash function is one-way (preimage resistant), such a result can only be achieved by testing possibilities one by one, which requires energy. The obtained preimage is called a proof of work.</p>
<p>The proof of work is performed by successively computing hashes of a string composed of base information and a varying number, called the counter or nonce. The base information generally includes context details indicating when the proof of work was produced (identifier, date, time, protocol, etc.) to demonstrate that the proof has not been previously used.</p>
<p>Let’s take an example to illustrate this. First, we choose base information specific to the context: to produce a proof of work related to this book and its writing date, we might opt for the base information <code>20231031181000:BitcoinElegance:</code>. Then, we determine the degree of the proof of work—that is, the number of binary zeros the hash must start with, here 16. Next, we search for the desired result by incrementing the nonce: at each iteration, we concatenate it with the base information and check if the hash of the whole satisfies the requirement. The work stops when the hash begins with a sufficient number of zeros; in this case, after 95,690 attempts. Our proof of work is thus:</p>
<pre data-fontsize="\footnotesize"><code>20231031181000:BitcoinElegance:95690</code></pre>
<p>And the corresponding hash, starting with 4 hexadecimal zeros (i.e., 16 binary zeros), is:</p>
<pre data-fontsize="\footnotesize"><code>0000387b99b1412e3cb6e49548cc0d11bdc797138e1a0f5ff095279a710b895a</code></pre>
<p>The steps of this procedure are detailed in Table&nbsp;<a href="#table:hashcash-hashes" data-reference-type="ref" data-reference="table:hashcash-hashes">8.1</a>.</p>
<div id="table:hashcash-hashes">
<table class="caption-top table">
<caption>Searching for the proof of work using the base information <code>20231031181000:BitcoinElegance:</code>.</caption>
<thead>
<tr class="header">
<th style="text-align: right;"><strong>Nonce</strong></th>
<th style="text-align: center;"><strong>Hash (SHA-256)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: center;">933c448c18e334c1cc5191f035d8581af611417578392b2d695d521c29b396d5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: center;">50530c98d1b171826b3d26fa5442e4ce7aa1f8a1277b71bc74d3adc1cd88b9ae</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: center;">fa27ed560df22d676d69966c9a981c5adfc395b4e7f78ca54d2593a98fd2ea38</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: center;">011692df53a84ecdddcd154de4f329e7311090580adb189e8360ea1729d75c99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">95,690</td>
<td style="text-align: center;">0000387b99b1412e3cb6e49548cc0d11bdc797138e1a0f5ff095279a710b895a</td>
</tr>
</tbody>
</table>
</div>
<p>Statistically, this type of search requires trying 65,536 possibilities (<span class="math inline">\(2^{16}\)</span>) to find a solution. On average, producing such a proof of work demonstrates that a commensurate effort has been made. Moreover, there is an asymmetry between production and verification, the latter requiring only a single application of the hash function and thus being low-cost.</p>
<p>The average production cost imparts a certain scarcity to proofs of work: the higher their degree, the harder they are to produce. This is why they can be used as quality markers for email, as in Hashcash, or as basic monetary units, as in bit gold and RPOW.</p>
<p>Bitcoin’s mining incorporates Hashcash’s proof-of-work process in a variant form: the goal is to find a hash less than a specific target value, rather than a hash starting with a determined number of zeros. This process is applied between blocks of transactions, so these blocks—or rather their headers, as we will explain below—constitute the proofs of work themselves.</p>
<p>In Bitcoin, the role of proof of work is twofold: to require a cost for creating new bitcoins and to ensure the network can reach consensus. On one hand, it aims to impose a cost on the unit of account. This echoes models that preceded Bitcoin, and it’s why Hal Finney went so far as to describe bitcoins as “POW tokens” in 2009<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. However, bitcoins are not exactly proofs of work in the sense that their production difficulty is variable, evolving according to the total computing power deployed on the network. Except in the edge case of the protocol’s minimum difficulty, the goal is to ensure that unit production requires energy, not to demand a fixed work cost. On the other hand, proof of work aims to guarantee network consensus by ensuring that honest nodes agree on who owns what. It limits access to block production: the selection of the validator (miner) is based on the amount of energy expended. Here, proof of work serves its role as a defense against Sybil attacks by preventing attackers from setting up a large number of nodes to control the system<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;Hal Finney, “Bitcoin v0.1 released,” January 24, 2009, 16:48:03 UTC: <a href="https://www.metzdowd.com/pipermail/cryptography/2009-January/015036.html" class="uri">https://www.metzdowd.com/pipermail/cryptography/2009-January/015036.html</a>.</p></div><div id="fn12"><p><sup>12</sup>&nbsp;“If the majority were based on one-IP-address-one-vote, it could be subverted by anyone able to allocate many IPs. Proof-of-work is essentially one-CPU-one-vote.” — Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>This functioning means that the blockchain forms a chain of proofs of work, summarizing all the work done since inception. Thus, the chain creates a linear history that is difficult to alter, as we will see.</p>
</section>
<section id="la-chaîne-de-blocs" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="la-chaîne-de-blocs">The Blockchain</h2>
<p>The blockchain is, as its name suggests, a data structure that groups all transactions made since the system’s launch. This structure is a series of timestamped and worked blocks of transactions. It begins with a genesis block, valid by default, from which blocks are counted: this index is called the <em>height</em> and indicates the block’s position in the chain in mining order. Blocks can also be counted in the other direction from the most recently mined block, in which case we speak of <em>depth</em>.</p>
<p>Each block has a unique identifier that distinguishes it from others. This is obtained by hashing the block’s header (the data placed before the transactions) using double SHA-256. Each block contains the identifier of the previous block, so the blocks are linked to form a chain. Since only the header is involved in calculating the identifier, the blockchain can actually be reduced to a chain of headers, to which transactions are cryptographically linked. The identifier starts with a certain number of zeros, indicating that work has been required. Thus, the block itself constitutes the proof of work.</p>
<p>All blocks are organized the same way, so by examining one in detail, we can understand how the chain is structured. Let’s study a block from Bitcoin’s main version (BTC), taking as an example block height 751,005, mined on August 25, 2022, which contains six transactions.</p>
<p>Each block breaks down into an 80-byte header containing its essential information and a raw sequence of transactions. By convention, the first transaction in the block is the coinbase transaction used to reward the miner for this block, as we will see later.</p>
<p>The header is divided into six elements: the block version, the previous block’s identifier linking it to the current block, a Merkle root that cryptographically binds all transactions to the header, the block’s timestamp, the network’s target value, and the nonce related to mining. The different pieces of information in the header are transmitted with a reversed byte order (called “little-endian”) compared to the standard reading order (“big-endian”). We present them here in the standard order.</p>
<section id="block-version" class="level3">
<h3 class="anchored" data-anchor-id="block-version">Block Version</h3>
<p>The block version indicates the set of rules the block adheres to. Historically, version 1 signified compliance with the rules originally defined by Satoshi. Versions 2 to 4 were used to enforce protocol changes between 2013 and 2015. Since 2016, this version field is used for miners to signal in the context of a soft fork implementation via BIP-9 or an equivalent mechanism. The version field of our block is:</p>
<pre data-fontsize="\footnotesize"><code>0b00100000000000000000000000000100</code></pre>
</section>
<section id="previous-block-identifier" class="level3">
<h3 class="anchored" data-anchor-id="previous-block-identifier">Previous Block Identifier</h3>
<p>The previous block identifier links the current block’s header to the previous block’s header. In the case of the genesis block, this field is conventionally set to zero. In our block, it is the identifier of block 751,004, which is:</p>
<pre data-fontsize="\footnotesize"><code>000000000000000000073ad6c18c81f2f67b2ca5b5ace8d23cce95812af8c7b6</code></pre>
</section>
<section id="merkle-root" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="merkle-root">Merkle Root</h3>
<p>The third element of the header is the Merkle root, corresponding to the final hash of the transaction arrangement in a Merkle tree.</p>
<p>A Merkle tree, also known as a hash tree, is a data structure conceptualized in 1979 by cryptographer Ralph Merkle to verify the contents of a data volume without inspecting all of it. In such a structure, data (forming the leaves of the tree) are arranged in a certain order and hashed individually:</p>
<p><span class="math display">\[H_A = \mathrm{SHA256d}(~\mathrm{tx}_A~)\]</span></p>
<p>Then, the resulting hashes are concatenated in pairs (the second hash placed after the first) and the combined hash is computed:</p>
<p><span class="math display">\[H_{A\!B} = \mathrm{SHA256d}(~H_A \parallel H_B~)\]</span></p>
<p>This process is repeated. If the number of hashes to combine is odd, the last hash is concatenated with itself:</p>
<p><span class="math display">\[H_{E\!F\!E\!F} = \mathrm{SHA256d}(~H_{E\!F} \parallel H_{E\!F}~)\]</span></p>
<p>Once only one hash remains, the tree is complete: the final hash obtained is the Merkle root.</p>
<p>The Merkle root of block 751,005 is:</p>
<pre data-fontsize="\footnotesize"><code>268a15b56fe847a067624bd0be186c375baccae9ac6db304438e9da657fe51d9</code></pre>
<p>Including the Merkle root in the header prevents anyone from modifying, adding, or deleting a transaction without altering the header itself and reproducing the proof of work. Thus, all transactions are attached to the header, ensuring the block’s integrity.</p>
<div id="fig:merkle-tree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/merkle-tree.png" class="img-fluid figure-img"></p>
<figcaption>Representation of a Merkle tree with six leaves.</figcaption>
</figure>
</div>
<p>This organization is particularly useful for lightweight wallets (known as Simplified Payment Verification or SPV wallets) that do not store the entire blockchain but only the chain of headers, which is much less voluminous (just over 62 MB as of November 2023). Indeed, to verify the presence of a transaction in a block, they can simply request the related branch information (Merkle path) and perform the hashes themselves<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>. For example, a user wanting to confirm the transaction <span class="math inline">\(\mathrm{tx}_D\)</span> needs only to request <span class="math inline">\(H_C\)</span>, <span class="math inline">\(H_{A\!B}\)</span>, and <span class="math inline">\(H_{E\!F\!E\!F}\)</span> from network nodes and perform the necessary hashes to compare the obtained root with that in the header. This greatly reduces the load on lightweight wallets.</p>
<div class="no-row-height column-margin column-container"><div id="fn13"><p><sup>13</sup>&nbsp;Demonstrating that a leaf is part of a Merkle tree requires computing a number of hashes proportional to the binary logarithm of the number of leaves (<span class="math inline">\(\log_{2}(n)\)</span>), not proportional to the number of leaves <span class="math inline">\(n\)</span>. For a block with 3,000 transactions (a high average on BTC), this represents 12 hashes of 32 bytes to obtain and 12 hashes to compute.</p></div></div><p>Since the activation of SegWit on August 24, 2017, each block contains an additional Merkle tree, subordinate to the classical transaction tree described above. This is the witness tree, which is the tree of transactions including SegWit transaction signatures (separated from classical transactions). The root of the witness tree is placed in the coinbase transaction, so it is included in the main Merkle root, ensuring the integrity of the whole.</p>
</section>
<section id="timestamp" class="level3">
<h3 class="anchored" data-anchor-id="timestamp">Timestamp</h3>
<p>The timestamp indicates the date and time of the block’s construction as declared by the miner. Technically, it is given by the Unix time, which is the number of seconds elapsed since January 1, 1970, at 00:00:00 UTC. For our block, the timestamp is <span class="math inline">\(1661407005\)</span>, corresponding to August 25, 2022, at 5:56:45 AM (UTC).</p>
<p>The miner cannot choose this timestamp arbitrarily. The declared time must be in the future relative to the Median Time Past (MTP)—the median of timestamps of the last 11 blocks, which generally lags about an hour behind real time—and must not exceed the receiver nodes’ clocks by more than two hours. This relatively permissive constraint allows the network time to remain reasonably consistent with reality.</p>
</section>
<section id="target-value" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="target-value">Target Value</h3>
<p>The target value is the maximum value that the block identifier can take for the block to constitute a valid proof of work. The smaller this target value, the harder it is to find a solution and mine a block. It is determined by the network according to the difficulty adjustment algorithm rules.</p>
<p>The target value is encoded as a floating-point number where the first byte represents a specific exponent and the next three bytes determine the mantissa. Here, it equals <span class="math inline">\(\mathtt{0x09ed88} \times 256^{(\mathtt{0x17} - 3)}\)</span>, which is:</p>
<pre data-fontsize="\footnotesize"><code>00000000000000000009ed880000000000000000000000000000000000000000</code></pre>
<p>This information also provides the block’s mining difficulty, which is inversely proportional to the target value. It is the quotient of the system’s maximum target value by the network’s target value<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>. The protocol’s minimum difficulty is therefore 1, and that of our block (rounded to the nearest whole number) is <span class="math inline">\(28,351,606,743,494\)</span>, representing a massive differential! It also gives the block’s amount of work, which is the average number of hashes needed to find a solution<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn14"><p><sup>14</sup>&nbsp;Denoting <span class="math inline">\(c\)</span> as the target value, the difficulty is defined by: <span class="math display">\[d = \frac{C_{\mathrm{max}}}{c}\]</span> where <span class="math inline">\(C_{\mathrm{max}} = \mathtt{0x00ffff} \times 256^{26}\)</span> is the network’s maximum target value.</p></div><div id="fn15"><p><sup>15</sup>&nbsp;Mathematically, the work of a block is the quotient of the number of possible hashes by the number of hashes satisfying the problem. Denoting <span class="math inline">\(c\)</span> as the target value, the work is: <span class="math display">\[T = \frac{2^{256}}{c + 1} ~.\]</span></p></div></div></section>
<section id="nonce" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="nonce">Nonce</h3>
<p>The nonce denotes the number that the miner varies to produce the proof of work. The word comes from the English expression “for the nonce,” meaning “for the occasion,” indicating its specific role<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>. The miner also varies an additional nonce within the coinbase transaction, as the nonce field is too small (8 bytes) for the current mining difficulty. The nonce of our block is <span class="math inline">\(4,224,551,499\)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="fn16"><p><sup>16</sup>&nbsp;A popular etymology claims it’s a contraction of “number used once,” but this is incorrect.</p></div></div><p>These last two parameters (target value and nonce) relate to the proof of work and are involved in formulating the mathematical problem solved by the miner. This problem presents as a mathematical inequality. Denoting <span class="math inline">\(c\)</span> as the network’s target value and <span class="math inline">\(\mathrm{HB}\)</span> as the block header, the task is to find a nonce <span class="math inline">\(n\)</span> such that:</p>
<p><span class="math display">\[\mathrm{SHA256d} ( \ \mathrm{HB} ( \ n \ ) \ ) ~ \le ~ c\]</span></p>
<p>As mentioned, the result is used as the block’s identifier. The proof of work is easily verifiable: each network member can, based on the block’s data, ensure the miner has found a valid solution. In our case, comparing the identifier and the target value, we indeed obtain a result satisfying the required inequality:</p>
<p><span class="math display">\[\begin{aligned}
\mathtt{0x000000000000000000065aebf106c8824f4b565d54d6d6df32498b2b041cfd07} &amp; \le \\ \mathtt{0x00000000000000000009ed880000000000000000000000000000000000000000} &amp; ~
\end{aligned}\]</span></p>
<div id="fig:bitcoin-segwit-block" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/bitcoin-segwit-block.png" class="img-fluid figure-img"></p>
<figcaption>Diagram of a Bitcoin block (with SegWit).</figcaption>
</figure>
</div>
</section>
</section>
<section id="le-revenu-du-minage" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="le-revenu-du-minage">Mining Revenue</h2>
<p>One of Bitcoin’s innovations is rewarding transaction confirmations using its internal unit of account. This feature creates an economic incentive encouraging miners to behave properly, contributing to the system’s robustness.</p>
<p>The reward for adding a block to the chain partly comes from the protocol’s monetary creation, hence the term “mining” used to describe this activity. The process is analogous to real-world gold extraction: miners deploy capital and expend energy to obtain new bitcoins. As Satoshi noted in the whitepaper:</p>
<p>“The steady addition of a constant amount of new coins is analogous to gold miners expending resources to add gold to circulation<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn17"><p><sup>17</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>The second part of the reward comes from transaction fees paid by users, collected from the transactions included in the block. The total is forwarded to the miner when the block is verified and accepted by the network.</p>
<p>Mining is thus the economic activity of gathering transactions into a block, producing the proof of work, and broadcasting the result across the network. Here, we distinguish it from simple hashing, which involves only performing calculations to create the proof of work and can be done independently of transaction selection, particularly within mining pools. In this context, miners are individuals or groups performing the complete activity, and entities merely setting up machines and delegating their power over transaction selection are merely “hashers.”</p>
<p>Mining operates cyclically. First, the miner selects transactions from their node’s transaction pool (called the <em>mempool</em>). Then, they construct a candidate block by setting a header, assembling the transactions, and carefully creating a coinbase transaction that rewards them. They then vary the nonce and other elements of the candidate block to produce the proof of work. If they find a solution, they broadcast the block to the network as quickly as possible so other nodes can verify it and accept it as the new block in the chain. If not, and a new block is found in the meantime, the miner accepts it and abandons their candidate block. In either case, the process restarts with different transactions.</p>
<p>The mining reward is thus collected by the miner by including a coinbase transaction within the block. This must, by convention, be the first transaction of the block. It has a unique input that does not reference any existing transaction. The coinbase transaction is also called the base of the coin because it is from this that new bitcoins are formed. The miner directs this transaction to an address they control, so they are rewarded only if their block is valid in the eyes of the network. The reward the miner can allocate to themselves must be less than or equal to the sum of the monetary creation and transaction fees. Thus, the miner can choose to reward themselves less than what the protocol allows, although this lacks direct economic sense<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn18"><p><sup>18</sup>&nbsp;In December 2017, the miner of block 501,726 rewarded themselves with the tidy sum of 0 BTC!</p></div></div><p>Monetary creation occurs entirely through the coinbase transaction. All bitcoins in the system result from a series of transfers starting with such a transaction.</p>
<p>The particularity of this monetary creation is that it’s fixed over time and isn’t proportional to the computing power deployed. This is made possible by the difficulty adjustment algorithm, which derives from the fact that the system acts as a distributed timestamp server. Indeed, since blocks are timestamped, it’s possible to measure their past production rate and adjust mining difficulty accordingly. As Satoshi wrote:</p>
<p>“To compensate for increasing hardware speed and varying interest in running nodes over time, the proof-of-work difficulty is determined by a moving average targeting an average number of blocks per hour. If they’re generated too fast, the difficulty increases<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn19"><p><sup>19</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div><div id="fn20"><p><sup>20</sup>&nbsp;In Bitcoin Core, the difficulty adjustment algorithm is described by the <code>CalculateNextWorkRequired</code> function in the file <code>pow.cpp</code>. The variation is limited to a factor of 4 (both multiplication and division) to prevent instabilities. The algorithm <em>overestimates</em> the deployed computing power because the elapsed time is measured over 2,015 intervals, not 2,016 as it should be.</p></div></div><p>In Bitcoin’s main version, the targeted interval between each block (block time) is 10 minutes, or 600 seconds. The adjustment occurs every 2,016 blocks, roughly every two weeks, based on the simple average block time over that period. The new target value is calculated<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> from the previous target value (<span class="math inline">\(c_{k-1}\)</span>) and the elapsed time since the last adjustment (<span class="math inline">\(t_{k-1}\)</span>):</p>
<p><span class="math display">\[c_{k} = \frac{c_{k-1} \cdot t_{k-1}}{2016 \cdot 600}\]</span></p>
<p>Thanks to this adjustment, bitcoin has a determined monetary policy, not subject to the direct arbitrariness of a trusted third party or the amount of deployed capital. This characteristic differentiates it from fiat money (like the dollar), which is issued discretionarily by a central bank, or precious metals (like gold), whose extracted quantity varies and follows market demand in the long term. This monetary policy was precisely described for the first time by Satoshi Nakamoto in his launch email on January 8, 2009, where he wrote:</p>
<p>“The total amount of coins in circulation will be 21,000,000. They will be distributed to network nodes when they create blocks, with the amount issued halving every 4 years.</p>
<p>First 4 years: 10,500,000 coins<br>
Next 4 years: 5,250,000 coins<br>
Next 4 years: 2,625,000 coins<br>
Next 4 years: 1,312,500 coins<br>
etc…</p>
<p>Once this sum is exhausted, the system can support transaction fees if necessary. It relies on open market competition, and there will probably always be nodes willing to process transactions for free<a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn21"><p><sup>21</sup>&nbsp;Satoshi Nakamoto, “Bitcoin v0.1 released,” January 8, 2009, 19:27:40 UTC: <a href="https://www.metzdowd.com/pipermail/cryptography/2009-January/014994.html" class="uri">https://www.metzdowd.com/pipermail/cryptography/2009-January/014994.html</a>.</p></div></div><p>This policy is, of course, coded into the system, where it is called a subsidy.</p>
<p>The main originality of this monetary policy is that monetary creation is abruptly halved every 210,000 blocks (approximately every four years) during what is commonly called a <em>halving</em>. By 2023, three halvings had already occurred on the main Bitcoin network: the first on November 28, 2012, when the protocol’s subsidy dropped from 50 bitcoins per block to 25; the second on July 9, 2016, reducing it to 12.5 bitcoins per block; and the third on May 11, 2020, further reducing it to 6.25 bitcoins per block. The next halving is expected around April 2024, after which new bitcoins issued will be 3.125 per block. Unless the consensus rules change, the 33rd and final halving will occur around 2140, as the monetary creation per block will then fall below one satoshi, effectively zero when truncated to whole units.</p>
<p>In the long term, this atypical monetary policy makes bitcoin a fixed-quantity currency. Indeed, the maximum amount of bitcoins in circulation is expected to approach a limit over time: the famous 21 million cap. This is simply a deduction from the aforementioned issuance conditions, expressed mathematically by the convergence of the sums of amounts mined between halvings<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn22"><p><sup>22</sup>&nbsp;This convergence is illustrated by Zeno’s paradox of Achilles and the tortoise. The series <span class="math inline">\(\left( \sum_{i=1}^{n} (1/2)^i \right)\)</span> converges to <span class="math inline">\(1\)</span> as <span class="math inline">\(n\to+\infty\)</span>.</p></div></div><p><span class="math display">\[N_{\mathrm{max}} = \sum_{i=0}^{+\infty} \left( {210,000 \cdot \frac{50}{2^i}} \right) = 21,000,000 \cdot \sum_{i=1}^{+\infty} \left(\frac{1}{2}\right)^i = 21,000,000\]</span></p>
<p>The 21 million limit is an upper bound: in the absence of a change in the consensus rules, it will never be formally reached due to the optional nature of the mining reward, the discrete nature of the units, and the irreversible loss of bitcoins. Additionally, bitcoins whose owners have lost their private keys significantly reduce the actual quantity of bitcoins in circulation, though this isn’t accounted for in the calculation.</p>
<p>Monetary creation is thus intended to diminish and become negligible, and this will happen sooner than one might think. Indeed, by 2023, the number of spendable bitcoins had already exceeded 19.5 million. Therefore, logically, this subsidy should be replaced by the other source of miner revenue: transaction fees<a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn23"><p><sup>23</sup>&nbsp;“Once a predetermined number of coins have entered circulation, the incentive can transition entirely to transaction fees and be inflation-free.” — Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, March 24, 2009.</p></div></div><p>Transaction fees are commissions paid by users for confirming their transactions. Transaction fees can be paid directly by the sender (client) or indirectly by the recipient (merchant) through a discount on the sold product. They are collected by the miner on each transaction in the block according to an implicit rule: it is the difference between the transaction’s input amount and its output amount. This difference can be zero (free transaction), but it is always accounted for. Fees are added to the coinbase transaction indistinctly from bitcoins generated by monetary creation. Bitcoin thus incorporates an internal and optimized transaction fee system, avoiding unnecessary bloating of transactions and blocks.</p>
<p>The existence of transaction fees is intended to persist by design, even if they become very low. Contrary to Satoshi’s opinion, confirming a transaction generally has a cost, even marginal<a href="#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a>, and a transaction that pays too few fees relative to the load it brings has no economic reason to be confirmed. Therefore, there’s no reason to imagine the blockchain stopping.</p>
<div class="no-row-height column-margin column-container"><div id="fn24"><p><sup>24</sup>&nbsp;The only conceivable case of a free transaction is a large consolidation transaction that would reduce miners’ load by significantly decreasing the set of unspent transaction outputs.</p></div></div><p>Moreover, protocol rules usually restrict block space through an explicit limit on block size (or weight). This restriction creates a production ceiling that, when reached, causes a rational miner to select transactions paying the highest fee rates, all else being equal. Thus, in the case of network congestion, there’s an auction effect that can drastically increase the average fee level.</p>
<p>Although fees are the main way envisioned to compensate miners in the long run, alternative financing methods have been proposed.</p>
<p>The first is tail emission, which involves maintaining a constant monetary creation over time to ensure mining revenue doesn’t drop too low<a href="#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a>. Introducing this feature would alter bitcoin’s monetary policy and eliminate the 21 million cap, making it highly controversial.</p>
<div class="no-row-height column-margin column-container"><div id="fn25"><p><sup>25</sup>&nbsp;Peter Todd, “Surprisingly, Tail Emission Is Not Inflationary,” July 9, 2022: <a href="https://petertodd.org/2022/surprisingly-tail-emission-is-not-inflationary" class="uri">https://petertodd.org/2022/surprisingly-tail-emission-is-not-inflationary</a>.</p></div></div><p>For example, tail emission has been implemented in the Monero variant since 2015. It became effective on June 9, 2022, after which 0.3 monero are created per minute, representing an annualized monetary creation rate of 0.87% at that time. A similar tail emission exists in Dogecoin since 2015, at 10,000 dogecoins per minute, with an annualized rate of 3.7% as of November 2023.</p>
<p>The second proposed financing method is demurrage, or holding cost, which involves taxing currency that has remained idle for a given time<a href="#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a>. Satoshi’s bitcoins, representing a significant financial windfall, are particularly affected. However, this would infringe upon Bitcoin’s property system, making it unlikely for this method to gain traction.</p>
<div class="no-row-height column-margin column-container"><div id="fn26"><p><sup>26</sup>&nbsp;Jorge Timón, “Freicoin: bitcoin with demurrage,” February 24, 2011, 11:56:03 UTC: <a href="https://bitcointalk.org/index.php?topic=3816.msg54170#msg54170" class="uri">https://bitcointalk.org/index.php?topic=3816.msg54170#msg54170</a>.</p></div></div></section>
<section id="la-chaîne-la-plus-longue" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="la-chaîne-la-plus-longue">The Longest Chain</h2>
<p>Now let’s address the central topic of this chapter: achieving consensus through mining. As we have explained, mining is the process allowing miners to add blocks to the chain, for which they are rewarded. But we have not detailed how this enables reaching agreement in an antagonistic context, with malicious “Byzantine” actors present.</p>
<p>Nodes follow a protocol composed of network rules, allowing them to communicate, and consensus rules, concerning the form of transactions and blocks, which we will detail in Chapter&nbsp;<a href="#ch:changement" data-reference-type="ref" data-reference="ch:changement">10</a>. Nodes that violate these rules have their connections closed by their peers and are blacklisted if necessary. It is therefore impossible to have a transaction or block accepted by the network that is not valid according to the consensus rules.</p>
<p>Nonetheless, Byzantine nodes can sow discord while respecting the consensus rules by producing competing blocks. Indeed, nothing inherently prevents an attacker from producing valid transaction blocks not attached to the main branch and submitting them to the network.</p>
<p>This problem is solved through a simple yet effective principle: the longest chain principle. This was described by Satoshi in the whitepaper:</p>
<p>“The majority decision is represented by the longest chain, which has the greatest proof-of-work effort invested in it<a href="#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn27"><p><sup>27</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div><div id="fn28"><p><sup>28</sup>&nbsp;In reality, initially, it was indeed the chain with the most blocks that was selected. But this principle was redefined on July 25, 2010, in version 0.3.3 of the software to account for work.</p></div></div><p>Network nodes agree by selecting the chain with the most accumulated work, which generally materializes as the chain with the most blocks<a href="#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a>. When a chain with strictly more work is published, nodes follow that chain, whether it continues from the last one or references an older branch. This rule ensures nodes always follow the chain where a greater amount of energy has been invested. The consensus algorithm resulting from applying this principle is called Nakamoto’s Proof-of-Work consensus algorithm, in honor of its creator.</p>
<p>The best way to understand this algorithm’s functioning is to consider a fork in the chain. Such a fork can be created by a malicious actor but is usually generated accidentally when two distant miners each find a different block within a short time interval, and network nodes receive different blocks first. There’s then no way to differentiate between the two branches, as both are correct under the longest chain principle. This type of accidental fork is common and occurs occasionally on the network due to latency.</p>
<p>This situation and its resolution were described by Satoshi in the whitepaper:</p>
<p>“If two nodes broadcast different versions of the next block simultaneously, some nodes may receive one or the other first. In that case, they work on the first one they received but save the other branch in case it becomes longer. The tie is broken when the next proof-of-work is found, and one branch becomes longer; the nodes that were working on the other branch then switch to the longer one<a href="#fn29" class="footnote-ref" id="fnref29" role="doc-noteref"><sup>29</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn29"><p><sup>29</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>The network goes through three stages. Initially, it behaves as expected: miners extend the longest chain, on which the rest of the nodes coordinate. Then, the conflict occurs: two correct branches coexist, and miners work to extend the chain from the block they received first. Finally, the fork is resolved: a miner finds a new block, and their chain, now longer, is accepted by the network.</p>
<p>A reorganization then occurs, reconciling the network nodes. The block from the weaker branch is considered incorrect and set aside. We say this block is orphaned as it loses its attachment to the parent chain<a href="#fn30" class="footnote-ref" id="fnref30" role="doc-noteref"><sup>30</sup></a>. The stronger branch (with the most accumulated work) is considered the correct version of the chain.</p>
<div class="no-row-height column-margin column-container"><div id="fn30"><p><sup>30</sup>&nbsp;The somewhat ambiguous term “orphan block” was introduced by Satoshi Nakamoto in the first version of the software. It is also called an “uncle block” (referring to its lack of productive descendants) or a “stale block.”</p></div></div><div id="fig:blockchain-common-fork" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/blockchain-common-fork.png" class="img-fluid figure-img"></p>
<figcaption>Diagram of a common chain fork.</figcaption>
</figure>
</div>
<p>All conflicts on the network are resolved this way, which imparts particular characteristics to Nakamoto’s algorithm and, by extension, to Bitcoin.</p>
<p>First, this functioning imposes two major security constraints. The first is that the network’s mining security relies on the assumption that a majority of the computing power (“51%”) behaves honestly. As Satoshi explained:</p>
<p>“The system is secure as long as honest nodes collectively control more CPU power than any cooperating group of attacker nodes<a href="#fn31" class="footnote-ref" id="fnref31" role="doc-noteref"><sup>31</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn31"><p><sup>31</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>The second is that the security of a given transaction is probabilistic and depends on its depth in the chain. The transaction is first verified by the network (zero confirmation), then confirmed within a block (one confirmation), and eventually considered irreversible, generally after six confirmations for ordinary amounts on Bitcoin’s main version. This constrains the user to estimate the number of confirmations they must wait for based on the desired security.</p>
<p>This particularity is reflected in mining through the coinbase maturity, which is the number of confirmations required before the coinbase transaction’s output becomes spendable. This constraint is implemented to prevent misuse of funds due to a shallow reorganization. The delay on the BTC network is currently 101 confirmations.</p>
<p>Nakamoto’s algorithm also has three main advantages. First, it has the benefit of an objective criterion to rely on: everyone can reconstruct the chain from the genesis block and confirm it is the correct chain. Even in the extreme case of a global and prolonged network partition due to war or natural disaster, the system can eventually recoordinate<a href="#fn32" class="footnote-ref" id="fnref32" role="doc-noteref"><sup>32</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn32"><p><sup>32</sup>&nbsp;Satoshi Nakamoto, “Re: Anonymity,” July 8, 2010, 19:12:00 UTC: <a href="https://bitcointalk.org/index.php?topic=241.msg2071#msg2071" class="uri">https://bitcointalk.org/index.php?topic=241.msg2071#msg2071</a>.</p></div></div><p>Second, it allows open participation in consensus: all that is required of a miner is a valid proof of work, making mining anonymous by essence.</p>
<p>Finally, this proof-of-work algorithm ensures network robustness: a miner doesn’t need to know all other participants, allowing the network to be composed of tens (or even hundreds) of thousands of nodes.</p>
</section>
<section id="la-résistance-à-la-double-dépense" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="la-résistance-à-la-double-dépense">Resistance to Double Spending</h2>
<p>Double spending refers to an actor successfully having two transactions accepted by the network in succession, intending to destabilize the system’s state and benefit from it in some way. The second transaction may cancel the first, wherein the malicious actor makes a transfer back to themselves.</p>
<p>Double spending poses a problem for unconfirmed transactions—that is, transactions that have been broadcast to the network, verified by nodes, and placed in their mempools but not yet included in a block in the chain. No consensus has been reached about these transactions, but a merchant may choose to accept them when the amounts involved are small<a href="#fn33" class="footnote-ref" id="fnref33" role="doc-noteref"><sup>33</sup></a>. The risk is that a fraudster walks away with the goods and manages to have an alternative version of the transaction accepted by the network, either by broadcasting it simultaneously and hoping it reaches the miner first, by paying higher fees (which can be systematically done with Replace-by-Fee) to bribe the miner, or by pre-mining a block containing the transaction (Finney attack<a href="#fn34" class="footnote-ref" id="fnref34" role="doc-noteref"><sup>34</sup></a>).</p>
<div class="no-row-height column-margin column-container"><div id="fn33"><p><sup>33</sup>&nbsp;In a forum message in July 2010, Satoshi wrote about accepting unconfirmed transactions: “I think it will be possible for a payment processing company to provide a service of rapid transaction distribution with sufficient verification in 10 seconds or less. Network nodes accept only the first version of a transaction they receive to include in the block they’re working to generate. When broadcasting a transaction and someone else broadcasts a double-spend at the same time, it’s a race to propagate to as many nodes as possible. If one has a slight lead, it spreads geometrically faster on the network and reaches most nodes. […] The payment processor has connections to many nodes. When it receives a transaction, it sends it out and at the same time monitors the network for double-spends. If it receives a double-spend on any of its many listening nodes, it reports the transaction as bad.” — Satoshi Nakamoto, “Re: Bitcoin snack machine (fast transaction problem),” July 17, 2010, 22:29:13 UTC: <a href="https://bitcointalk.org/index.php?topic=423.msg3819#msg3819" class="uri">https://bitcointalk.org/index.php?topic=423.msg3819#msg3819</a>.</p></div><div id="fn34"><p><sup>34</sup>&nbsp;Hal Finney, “Re: Best practice for fast transaction acceptance - how high is the risk?,” February 13, 2011, 21:48:44 UTC: <a href="https://bitcointalk.org/index.php?topic=3441.msg48384#msg48384" class="uri">https://bitcointalk.org/index.php?topic=3441.msg48384#msg48384</a>.</p></div></div><p>The solution to this problem is to agree on the correct transaction to eliminate the double spending—which is precisely the purpose of mining. However, mining does not prevent double spending absolutely; it is rather a resistance mechanism. Let’s examine what guarantees this characteristic.</p>
<p>A number of opportunistic disruptions can occur in mining activity, such as the vector76 attack<a href="#fn35" class="footnote-ref" id="fnref35" role="doc-noteref"><sup>35</sup></a> or selfish mining<a href="#fn36" class="footnote-ref" id="fnref36" role="doc-noteref"><sup>36</sup></a>, but the most significant is the double-spending attack through chain reorganization. This involves using a significant portion of the network’s computing power (usually a majority) to rewrite the chain’s past and modify one or more transactions. This attack was precisely described by Satoshi Nakamoto in the whitepaper<a href="#fn37" class="footnote-ref" id="fnref37" role="doc-noteref"><sup>37</sup></a> and in his email response to John Levine on November 3, 2008<a href="#fn38" class="footnote-ref" id="fnref38" role="doc-noteref"><sup>38</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn35"><p><sup>35</sup>&nbsp;vector76, “Re: Fake Bitcoins?,” August 17, 2011, 17:37:56 UTC: <a href="https://bitcointalk.org/index.php?topic=36788.msg463391#msg463391" class="uri">https://bitcointalk.org/index.php?topic=36788.msg463391#msg463391</a>.</p></div><div id="fn36"><p><sup>36</sup>&nbsp;Ittay Eyal, Emin Gün Sirer, “Majority is not Enough: Bitcoin Mining is Vulnerable,” 2013.</p></div><div id="fn37"><p><sup>37</sup>&nbsp;“We consider the scenario of an attacker trying to generate an alternate chain faster than the honest chain. Even if successful, it does not open up arbitrary modifications […] An attacker can only try to modify one of his own transactions to recover the money he recently spent.” — Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div><div id="fn38"><p><sup>38</sup>&nbsp;“Even if a malicious individual managed to control the network, it’s not like he’s instantly rich. All he could do is get back money he himself spent, like bouncing a check. To exploit this, he’d have to buy something from a merchant, wait for it to be shipped, then take over the network and try to get his money back. I don’t think he could make as much money trying to pull a stunt like that as he could by generating bitcoins. With such a large botnet, he could generate more bitcoins than everyone else combined.” — Satoshi Nakamoto, “Re: Bitcoin P2P e-cash paper,” November 3, 2008, 16:23:49: <a href="https://www.metzdowd.com/pipermail/cryptography/2008-November/014818.html" class="uri">https://www.metzdowd.com/pipermail/cryptography/2008-November/014818.html</a>.</p></div></div><p>This attack is carried out in three steps. It can be executed using a minority of computing power, in which case it only has a certain probability of success. However, for simplicity, we’ll assume a miner has gathered the majority of the network’s computing power. The attack thus constitutes a 51% attack, also known as a majority attack.</p>
<p>The first step is purchasing a good or service from a merchant. The attacker conducts a legitimate bitcoin transaction in exchange for which the merchant provides something of equivalent value—typically another cryptocurrency or dollars from an exchange platform.</p>
<p>The second step involves mining a parallel chain. Once the legitimate transaction has been confirmed within a block, the attacker constructs a parallel chain in secret from the previous block, carefully not revealing it to the rest of the network. Simultaneously, they create and sign another transaction (the “fraudulent” one) spending the same bitcoins as the first but sending them to an address they control. They include this fraudulent transaction in their parallel chain. Since the attacker controls the majority of the network’s computing power, they are sure that, at some point, this chain will be longer than the other.</p>
<p>The third step is the chain reorganization, depicted in Figure&nbsp;<a href="#fig:doublespending-attack" data-reference-type="ref" data-reference="fig:doublespending-attack">8.5</a>. The attacker continues to mine their parallel chain until the good or service purchased is delivered. At that point, they reveal their chain to the rest of the network, which must accept it under the longest chain principle. Nodes then reorganize: blocks from the old chain are discarded (orphaned), their transactions returned to the mempool, and the new blocks are verified and added to the chain. Since the legitimate transaction spends the same funds as the fraudulent transaction included in the new chain, this legitimate transaction is invalidated as a double spend. The merchant no longer owns the bitcoins, which revert to the attacker.</p>
<div id="fig:doublespending-attack" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/mining-attack-doublespending.png" class="img-fluid figure-img"></p>
<figcaption>Double-spending attack through chain reorganization.</figcaption>
</figure>
</div>
<p>This is an opportunistic attack: it is motivated by gain—namely, the acquired good or service—which must exceed the cost (material, logistical, electrical, and software) necessary to carry it out. On the main Bitcoin network, this cost amounts to billions of dollars today<a href="#fn39" class="footnote-ref" id="fnref39" role="doc-noteref"><sup>39</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn39"><p><sup>39</sup>&nbsp;Braiins, “How Much Would it Cost to 51% Attack Bitcoin?,” January 11, 2021: <a href="https://braiins.com/blog/how-much-would-it-cost-to-51-attack-bitcoin" class="uri">https://braiins.com/blog/how-much-would-it-cost-to-51-attack-bitcoin</a>.</p></div></div><p>This attack must be distinguished from censorship, which we will describe in Chapter&nbsp;<a href="la-resistance-a-la-censure.html" data-reference-type="ref" data-reference="ch:censure">9</a> and involves refusing to confirm transactions based on arbitrary criteria. The latter relies on incentives <em>external</em> to Bitcoin’s economy, as a rational miner has no economic reason within the system not to include transactions paying a sufficient fee rate in their blocks.</p>
<p>As Satoshi emphasized, the system is secure as long as the majority of computing power is associated with honest nodes—that is, nodes not seeking to double-spend or censor. Mining security thus relies on a security barrier representing the financial burden on the attacker to execute a double-spend.</p>
<p>This barrier is not constructed benevolently but rests on the protocol’s reward, making mining an essentially <em>economic</em> process. Specifically, resistance to double spending—that is, the difficulty of executing a double-spend attack—directly derives from the total mining revenue, which incentivizes nodes to remain honest. As Satoshi wrote in the whitepaper:</p>
<p>“The incentive may help encourage nodes to stay honest. If a greedy attacker is able to assemble more CPU power than all the honest nodes, he would have to choose between using it to defraud people by stealing back his payments or using it to generate new coins. He ought to find it’s more profitable to play by the rules, such rules that favor him with more new coins than everyone else combined, than to undermine the system and the validity of his own wealth<a href="#fn40" class="footnote-ref" id="fnref40" role="doc-noteref"><sup>40</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn40"><p><sup>40</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>Not only might the reward exceed the gain from a double-spend attack, but the value of the bitcoins used in the transaction could also decrease due to the attack itself. Indeed, if the attack were successful, various actors might lose confidence in the system, stop using it for commerce, and sell some of their savings, causing the bitcoin’s exchange value and mining revenue to drop. Moreover, the specialization of mining hardware (when it exists) increases the attack’s cost, as such hardware loses utility value. From a purely opportunistic standpoint, it is thus usually more profitable to use one’s capital honestly.</p>
<p>It has happened that mining aggregates have accumulated more than 51% of computing power—like the GHash.io pool in July 2014—without any attack occurring. Even if such an attack took place, it wouldn’t necessarily be fatal for the system in the long term. As Satoshi wrote:</p>
<p>“Even in the event of an attack, it does not enable arbitrary changes, such as creating value out of thin air or taking money that never belonged to the attacker. Nodes will not accept an invalid transaction as payment, and honest nodes will never accept a block containing them<a href="#fn41" class="footnote-ref" id="fnref41" role="doc-noteref"><sup>41</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn41"><p><sup>41</sup>&nbsp;Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div><p>Thus, numerous such attacks have occurred on some Bitcoin variants over the years, reducing their reputations in the process, but without annihilating them. Notably, Ethereum Classic experienced several aggressive reorganizations between 2019 and 2020.</p>
</section>
<section id="lindustrie-minière" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="lindustrie-minière">The Mining Industry</h2>
<p>Mining is an economic activity in its own right, with the mining reward compensating miners for the service they provide. This reward pays for electricity costs, hardware and logistical infrastructure, and software maintenance. It compensates for the risk of producing orphaned blocks. It remunerates the confirmation of censored transactions. And finally, it rewards the temporary renunciation of liquidity (the lender’s originary interest) and general economic risk (the entrepreneur’s profit).</p>
<p>On the hardware side, miners need to deploy various components: hashing machines (including cooling systems) to perform the calculations related to proof of work; processors to process blocks and verify signatures; memory to store the chain (history), the set of unspent transaction outputs (state), and the pool of pending transactions; bandwidth to send and receive transactions and blocks; and so on. It’s evident that all this has become industrialized over the years.</p>
<p>The improvement of hashing machines illustrates this industrialization well. Initially, miners used their computer’s central processing unit (CPU) to mine. Then, in 2010, under the impetus of Laszlo Hanyecz and later ArtForz, mining with graphics processing units (GPUs) developed. In 2011, the first field-programmable gate array (FPGA) dedicated to mining appeared, offering better efficiency than graphics cards. Finally, in 2013, the first application-specific integrated circuits (ASICs) hit the market with the release of the Avalon ASIC. From then on, ASICs became increasingly powerful, notably due to work by the Chinese company Bitmain on its Antminers.</p>
<p>Some actors began industrial mining by piling this hashing power into large specialized warehouses containing hundreds of machines, known as mining farms. These farms were installed in locations considering specific factors, including electricity cost, temperature (cooling costs), bandwidth, and political stability. This emergence of mining farms composed of specialized equipment had been anticipated by Satoshi, who wrote as early as November 2008:</p>
<p>“At first, most users would run network nodes, but as the network grows beyond a certain point, it would be left more and more to specialists with server farms of specialized hardware. A server farm would only need to have one node on the network, and the rest of the local network connects with that one node<a href="#fn42" class="footnote-ref" id="fnref42" role="doc-noteref"><sup>42</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn42"><p><sup>42</sup>&nbsp;Satoshi Nakamoto, “Re: Bitcoin P2P e-cash paper,” November 3, 2008, 01:37:43 UTC: <a href="https://www.metzdowd.com/pipermail/cryptography/2008-November/014815.html" class="uri">https://www.metzdowd.com/pipermail/cryptography/2008-November/014815.html</a>.</p></div></div><p>As a result, the network’s computing power exploded. The hash rate, measured in hashes per second (H/s), experienced spectacular growth over the years. In 2009, it fluctuated between 1 and 7 million hashes per second (1 MH/s). During the first half of 2010, it increased to reach 200 MH/s in early July. It then underwent two major increases coinciding with speculative booms but also with the use of optimized methods. The first was in 2010–2011, when the price rose from less than a penny to $30, and the first GPU farms were used: between July 2010 and August 2011, the hash rate went from 200 MH/s to 15 TH/s (a 75,000-fold increase). The second was in 2013–2014, when the price nearly increased 100-fold and the first ASICs were deployed: the hash rate rose from 25 TH/s in January 2013 to 300 PH/s in December 2014 (a 12,000-fold increase). The hash rate then slowly increased to about 450 EH/s in November 2023 (a 1,500-fold increase since December 2014).</p>
<p>With this enormous growth in computing power, mining difficulty followed suit. By 2010, it became difficult to hope to mine a block with a personal computer’s CPU. This disadvantaged small miners. The increased difficulty highlighted an inherent flaw in mining: the variance defect. Since mining is subject to probabilities, an individual miner with a performant ASIC might not find any block at all, or might find more blocks than expected, making their income dependent on chance.</p>
<p>To correct this variance defect, mining pools emerged. These are groups of hashers who delegate their power over transaction selection to an operator to collectively contribute computing effort and smooth their income. Pool mining is based on producing partial proofs of work (PPoW) implemented by the Stratum protocol. Hashers produce lower-degree proofs of work for a given candidate block to prove they have expended energy and are compensated accordingly by the pool. The pool receives the mining reward each time a partial proof of work produced by a hasher also turns out to be a full proof of work (FPoW).</p>
<p>The first mining pool was launched on November 27, 2010, by Marek Palatinus (also known as “slush”). Initially called Bitcoin.cz Mining, it was later renamed Slush Pool in honor of its founder and became Braiins Pool in September 2022. Today, mining pools are numerous and concentrate most of the network’s computing power. They are generally based in jurisdictions where mining is prevalent, such as China (until 2021) or, more recently, the United States.</p>
<p>Pools often signal the blocks they mine for transparency. For example, the coinbase transaction of block 751,005 contains the string <code>poolin.com</code>, indicating that this block was likely validated by the Chinese pool Poolin. This signaling is not mandatory (mining is inherently anonymous) but provides an idea of the distribution among different pools (as seen in Figure&nbsp;<a href="#fig:hashrate-distribution" data-reference-type="ref" data-reference="fig:hashrate-distribution">8.6</a>) and allows estimation of the centralization of mining activity.</p>
<div id="fig:hashrate-distribution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/hashrate-distribution-coin-dance-week-20231012.png" class="img-fluid figure-img"></p>
<figcaption>Apparent BTC hash rate distribution among mining pools for the week of October 5–12, 2023. (source: coin.dance)</figcaption>
</figure>
</div>
<p>Another inherent flaw in mining is the latency associated with block announcements. As explained in the section on the longest chain, this latency produces orphaned blocks, which are valid but not attached to the main chain. This means poorly connected miners have an apparent hash rate lower than their actual hash rate.</p>
<p>To mitigate the effects of this flaw, miners have established communication relays allowing them to send blocks to each other more efficiently by removing the denial-of-service protections necessary on the open peer-to-peer network.</p>
<p>The first relay was created by Matt Corallo under the name <em>Bitcoin Relay Network</em>. It was launched in 2013 and became fully operational in 2015. The network comprised several specialized nodes hosted on Amazon Web Services infrastructure. A competitor was the Falcon network, managed by a team from Cornell University led by Emin Gün Sirer. The Bitcoin Relay Network was replaced in 2016 by the FIBRE network<a href="#fn43" class="footnote-ref" id="fnref43" role="doc-noteref"><sup>43</sup></a> (Fast Internet Bitcoin Relay Engine), a network based on UDP (an alternative protocol to TCP) that implements the <code>cmpctblock</code> optimization, still managed by Matt Corallo. This network is used by most miners today.</p>
<div class="no-row-height column-margin column-container"><div id="fn43"><p><sup>43</sup>&nbsp;Matt Corallo, “The Future of The Bitcoin Relay Network(s),” July 7, 2016: <a href="https://bluematt.bitcoin.ninja/2016/07/07/relay-networks/" class="uri">https://bluematt.bitcoin.ninja/2016/07/07/relay-networks/</a>.</p></div></div><p>This industrialization of mining has led to centralization in both hashing power (mining farms) and transaction selection (pools and relays). While this aggregation is not fatal (hashers are free to leave one pool for another, and miners are free not to use the relay), it nonetheless reduces the chain’s mining security.</p>
<p>Certain improvements have been proposed in mining to address this issue. The first is the P2Pool protocol, a cooperative mining protocol based on a peer-to-peer network of miners. It connects hashers using a side-chain—the “share chain”—with lower difficulty, grouping participants’ contributions. Development of P2Pool on the main Bitcoin version appears to have been suspended in 2017. However, the process has been implemented on Monero since October 2021 through a pool of the same name.</p>
<p>The second is the Stratum V2 protocol<a href="#fn44" class="footnote-ref" id="fnref44" role="doc-noteref"><sup>44</sup></a>, which allows (among other things) hashers to negotiate block content. While it doesn’t completely correct delegation in transaction selection, this new version of Stratum has the merit of making the process more transparent. As of November 2023, it was deployed only within the Braiins Pool (formerly Slush Pool), which is behind its design.</p>
<div class="no-row-height column-margin column-container"><div id="fn44"><p><sup>44</sup>&nbsp;Braiins, “Stratum V2 Protocol Overview”: <a href="https://braiins.com/stratum-v2#job-selection" class="uri">https://braiins.com/stratum-v2#job-selection</a>.</p></div></div><p>However, these proposed improvements, while commendable, do not eliminate the economic advantage derived from centralization, which is also found in all industries (economies of scale). Decentralization has a cost, justified only when the benefit it brings surpasses it—that is, when the network is truly under attack.</p>
</section>
<section id="un-algorithme-de-consensus-novateur" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="un-algorithme-de-consensus-novateur">An Innovative Consensus Algorithm</h2>
<p>To function as a distributed digital currency system, Bitcoin relies on an innovative consensus mechanism. It involves a blockchain built by miners, who are rewarded for their work. Each block is a timestamped set of transactions containing a proof of work quantifying the energy expended. Consensus is achieved by selecting the longest chain.</p>
<p>This consensus algorithm operates objectively, openly, and robustly, explaining Bitcoin’s success compared to its predecessors. Through its essentially economic aspect, it provides the system with strong resistance to opportunistic double-spending, notably thanks to the massive mining industry supporting it.</p>
<p>However, there exists a more significant and insidious threat: censorship, which we will discuss in the next chapter.</p>
<p><span class="math display">\[P = \frac{T}{\Delta t} = \frac{1}{\Delta t} \left( \frac{2^{256}}{\frac{C_{\mathrm{max}}}{d} + 1} \right)~.\]</span></p>
<p>where <span class="math inline">\(T\)</span> is the work of a block, and <span class="math inline">\(C_{\mathrm{max}} = \mathtt{0x00ffff} \times 256^{26}\)</span> is the network’s maximum target value.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/la-valeur-de-l-information.html" class="pagination-link" aria-label="The Value of Information">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Value of Information</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/la-resistance-a-la-censure.html" class="pagination-link" aria-label="Resistance to Censorship">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Resistance to Censorship</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2024 Konsensus Network
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../index.html">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../presale.html">
<p>Acheter</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/konsensusn">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/konsensusnetwork">
      <i class="bi bi-github" role="img" aria-label="Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/konsensusnetwork">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/konsensusnetwork">
      <i class="bi bi-youtube" role="img" aria-label="YouTube">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>