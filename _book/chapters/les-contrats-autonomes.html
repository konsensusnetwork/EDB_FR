<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Les contrats autonomes – L'Élégance de Bitcoin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/le-passage-a-l-echelle.html" rel="next">
<link href="../chapters/les-rouages-de-la-machine.html" rel="prev">
<link href="..//figures/freestarfish.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="13&nbsp; Les contrats autonomes – L’Élégance de Bitcoin">
<meta property="og:description" content="">
<meta property="og:image" content="cover.png">
<meta property="og:site_name" content="L'Élégance de Bitcoin">
<meta name="twitter:title" content="13&nbsp; Les contrats autonomes – L’Élégance de Bitcoin">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="cover.png">
<meta name="twitter:site" content="@konsensusn">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">L’Élégance de Bitcoin</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-book" role="img" aria-label="Book">
</i> 
<span class="menu-text">Lire en ligne</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bitcoinbook.shop/products/lelegance-de-bitcoin"> <i class="bi bi-shop" role="img" aria-label="Shop">
</i> 
<span class="menu-text">Acheter ce livre!</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/les-contrats-autonomes.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Les contrats autonomes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main">
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Recherche"></div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos de ce livre</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface-de-jacques-favier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface de Jacques Favier</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/remerciements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Remerciements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/avant-propos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Avant-propos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-debuts-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Les débuts de Bitcoin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/une-croissance-conflictuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Une croissance conflictuelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/des-racines-monetaires.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Des racines monétaires</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-necessite-de-decentralisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">La nécessité de décentralisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/un-mouvement-technologique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un mouvement technologique</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-cybermonnaie-avant-nakamoto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">La cybermonnaie avant Nakamoto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-valeur-de-l-information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">La valeur de l’information</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-consensus-par-le-minage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Le consensus par le minage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-resistance-a-la-censure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">La résistance à la censure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-changement-de-la-monnaie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Le changement de la monnaie</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-determination-du-protocole.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">La détermination du protocole</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-rouages-de-la-machine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les rouages de la machine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-contrats-autonomes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Les contrats autonomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-passage-a-l-echelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Le passage à l’échelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/l-avenir-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">L’avenir de Bitcoin</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#les-contrats-simples" id="toc-les-contrats-simples" class="nav-link active" data-scroll-target="#les-contrats-simples">Les contrats simples</a>
  <ul class="collapse">
  <li><a href="#le-compte-multisignatures" id="toc-le-compte-multisignatures" class="nav-link" data-scroll-target="#le-compte-multisignatures">Le compte multisignatures</a></li>
  <li><a href="#le-dépôt-fiduciaire" id="toc-le-dépôt-fiduciaire" class="nav-link" data-scroll-target="#le-dépôt-fiduciaire">Le dépôt fiduciaire</a></li>
  <li><a href="#le-financement-participatif" id="toc-le-financement-participatif" class="nav-link" data-scroll-target="#le-financement-participatif">Le financement participatif</a></li>
  <li><a href="#léchange-atomique" id="toc-léchange-atomique" class="nav-link" data-scroll-target="#léchange-atomique">L’échange atomique</a></li>
  </ul></li>
  <li><a href="#les-canaux-de-paiement" id="toc-les-canaux-de-paiement" class="nav-link" data-scroll-target="#les-canaux-de-paiement">Les canaux de paiement</a>
  <ul class="collapse">
  <li><a href="#les-canaux-de-paiement-de-poon-dryja" id="toc-les-canaux-de-paiement-de-poon-dryja" class="nav-link" data-scroll-target="#les-canaux-de-paiement-de-poon-dryja">Les canaux de paiement de Poon-Dryja</a></li>
  <li><a href="#les-canaux-de-paiement-de-decker-russell-osuntokun" id="toc-les-canaux-de-paiement-de-decker-russell-osuntokun" class="nav-link" data-scroll-target="#les-canaux-de-paiement-de-decker-russell-osuntokun">Les canaux de paiement de Decker-Russell-Osuntokun</a></li>
  </ul></li>
  <li><a href="#linscription-de-données-arbitraires" id="toc-linscription-de-données-arbitraires" class="nav-link" data-scroll-target="#linscription-de-données-arbitraires">L’inscription de données arbitraires</a></li>
  <li><a href="#les-métaprotocoles" id="toc-les-métaprotocoles" class="nav-link" data-scroll-target="#les-métaprotocoles">Les métaprotocoles</a></li>
  <li><a href="#les-contrats-hors-chaîne" id="toc-les-contrats-hors-chaîne" class="nav-link" data-scroll-target="#les-contrats-hors-chaîne">Les contrats hors chaîne</a></li>
  <li><a href="#une-monnaie-programmable" id="toc-une-monnaie-programmable" class="nav-link" data-scroll-target="#une-monnaie-programmable">Une monnaie programmable</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="ch:contrats" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Les contrats autonomes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><span id="enotezch:13" label="enotezch:13"></span></p>
<p><span class="lettrine">U</span><span class="smallcaps">n</span> contrat autonome, de l’anglais <em>smart contract</em>, est un programme informatique dont l’exécution ne nécessite pas l’intervention d’un tiers de confiance. On parle aussi de contrat auto-exécutable ou de contrat intelligent (traduction littérale). Chaque contrat est constitué de clauses qui sont des conditions de dépense spécifiques.</p>
<p>Bitcoin constitue la première implémentation concrète d’un système hébergeant des contrats autonomes, par le biais de son système de programmation interne qui met en œuvre des scripts au sein des transactions. Il permet d’exécuter une variété de contrats allant du compte multisignatures au canal de paiement, en passant par le dépôt fiduciaire. L’ouverture apportée par cette possibilité facilite l’inscription de données arbitraires sur la chaîne, un cas d’utilisation strictement non monétaire du protocole.</p>
<section id="les-contrats-simples" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="les-contrats-simples">Les contrats simples</h2>
<p>La notion de contrat autonome<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> a germé au sein du mouvement cypherpunk dans les années 1990. Elle a été exposée par Nick Szabo en 1994, qui la définissait comme suit&nbsp;:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;L’appellation «&nbsp;contrat autonome&nbsp;» visant à traduire <em>smart contract</em> a été proposée par Jacques Favier, Adli Takkal-Bataille et Benoît Huguet dans <em>Bitcoin&nbsp;: Métamorphoses</em> (pp.&nbsp;105–107) en 2018.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Nick Szabo, <em>Smart Contracts</em>, 1994, archive&nbsp;: <a href="https://web.archive.org/web/20011102030833/http://szabo.best.vwh.net:80/smart.contracts.html" class="uri">https://web.archive.org/web/20011102030833/http://szabo.best.vwh.net:80/smart.contracts.html</a>.</p></div></div><p>«&nbsp;Un contrat autonome est un protocole de transaction informatisé qui exécute les termes d’un contrat. Les objectifs généraux de la conception de contrats autonomes sont de satisfaire les conditions contractuelles courantes (telles que les conditions de paiement, les privilèges, la confidentialité et même l’exécution), de limiter au mieux les interruptions tant malveillantes qu’accidentelles, et de minimiser le besoin de recourir à des intermédiaires de confiance<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.&nbsp;»</p>
<p>Le transfert de valeur constitue le cas le plus simple de contrat autonome, ne contenant qu’une seule clause&nbsp;: la fourniture d’une signature numérique correspondant à une clé publique donnée. Mais une multitude d’autres contrats peuvent être implémentés sur Bitcoin, à tel point qu’il est impossible d’en dresser une liste exhaustive. Nous nous contenterons ici d’en décrire quelques exemples pour expliquer comment ils peuvent être mis en place. Voyons d’abord les cas spécifiques du compte multisignatures, du dépôt fiduciaire, du financement participatif et de l’échange atomique.</p>
<section id="le-compte-multisignatures" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="le-compte-multisignatures">Le compte multisignatures</h3>
<p>Le compte multisignatures est un compte partagé entre plusieurs entités. Il se base sur le schéma de signature multipartite décrit dans le chapitre&nbsp;<a href="les-rouages-de-la-machine.html" data-reference-type="ref" data-reference="ch:rouages">12</a>, dans lequel la dépense des fonds demande M signatures parmi N participants (ce qu’on appelle «&nbsp;M-parmi-N&nbsp;» ou «&nbsp;M-of-N&nbsp;» en anglais). Par exemple, la dépense depuis un compte 2-parmi-3 exige que 2 personnes parmi 3 participants prédéterminés produisent une signature valide, peu importe l’identité précise de ces personnes.</p>
<p>Ce type de contrat est utile pour avoir un compte joint entre époux (2 parmi 2), pour faciliter la détention par une entreprise (3 associés parmi 7 par exemple) ou pour améliorer la conservation de bitcoins en général. Les plateformes d’échange utilisent notamment ce type de contrat pour conserver leurs avoirs. En novembre 2023, la deuxième adresse la plus riche du monde en 2023 était ainsi l’adresse multisignatures 3-parmi-5 de Bitfinex contenant plus de 178&nbsp;000&nbsp;BTC<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;L’adresse multisignatures 3-parmi-5 de Bitfinex est bc1qgdjqv0av3q56jvd82tkdjpy7gdp9ut8tlqmgrpmv24sq90ecnvqqjwvw97.</p></div></div></section>
<section id="le-dépôt-fiduciaire" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="le-dépôt-fiduciaire">Le dépôt fiduciaire</h3>
<p>Le dépôt fiduciaire, appelé <em>escrow</em> en anglais, est une méthode basée sur le recours à un tiers de confiance, comme un notaire, pour sécuriser une transaction entre deux parties qui se méfient l’une de l’autre. L’utilisation de la programmabilité de Bitcoin permet de diminuer le pouvoir du tiers en incluant une limite dans la clause qui le concerne. Ce type de contrat repose sur deux briques techniques de base&nbsp;: la signature multipartite et les verrous temporels.</p>
<p>Prenons l’exemple de deux personnes qui ne se connaissent pas, Alice et Bob, et qui veulent réaliser une transaction en ligne&nbsp;: Alice est l’acheteuse, Bob le vendeur. Les deux parties font appel à un intermédiaire de confiance, Lenny, avec qui elles créent le contrat de dépôt fiduciaire. Alice y envoie les fonds et attend de recevoir le bien. Deux clauses peuvent alors être activées&nbsp;:</p>
<ul>
<li><p>Le règlement à l’amiable&nbsp;: le contrat est déverrouillé par les signatures des deux parties, qui peuvent choisir d’envoyer les fonds vers Bob (réussite de l’échange) ou bien de rembourser Alice (échec de l’échange)&nbsp;;</p></li>
<li><p>Le litige&nbsp;: après une période prédéterminée (par exemple 30 jours), le contrat est déverrouillé par la signature de Lenny et celle de l’une des deux parties&nbsp;; dans ce cas, Lenny se charge de déterminer qui est la partie honnête et de lui envoyer les fonds.</p></li>
</ul>
<div id="fig:escrow-contract" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/escrow-contract.png" class="img-fluid figure-img"></p>
<figcaption>Contrat de dépôt fiduciaire.</figcaption>
</figure>
</div>
<p>Ce fonctionnement, décrit sur la figure&nbsp;<a href="#fig:escrow-contract" data-reference-type="ref" data-reference="fig:escrow-contract">13.1</a>, incite d’une part les deux parties à coopérer pour ne pas perdre de temps, et empêche d’autre part la collusion de la tierce partie (Lenny) avec l’une des deux autres avant le délai prévu (30 jours ici). Le recours à la confiance est ainsi minimisé autant que possible.</p>
<p>Ce type de contrat était soutenu par Satoshi Nakamoto dans le livre blanc<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. En effet, l’irréversibilité des transferts dans Bitcoin offrait peu de garantie pour les commerçants, et le dépôt fiduciaire permettait d’atténuer le problème. C’est typiquement ce genre de mécanisme qui intervient aujourd’hui dans les plateformes de change de pair à pair comme Bisq ou Hodl Hodl, même si l’implémentation diffère de ce qui est présenté ici.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;«&nbsp;Les acheteurs pourraient être facilement protégés par la mise en œuvre de mécanismes de dépôt fiduciaire routiniers.&nbsp;» – Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, 31 octobre 2008.</p></div></div></section>
<section id="le-financement-participatif" class="level3">
<h3 class="anchored" data-anchor-id="le-financement-participatif">Le financement participatif</h3>
<p>Le financement participatif consiste à faire appel au grand public pour contribuer au soutien d’un projet, par opposition au financement par prêt bancaire ou par levée de fonds auprès des professionnels du capital-risque. Il s’agit le plus souvent d’un accord informel entre le promoteur du projet et le public ayant pour but de soutenir la création d’un bien commun, qui profite à tous. Dans Bitcoin, il est possible d’exécuter cet accord par le biais de promesses de paiement résiliables qui ne sont pas soumises à l’arbitraire d’un tiers de confiance.</p>
<p>D’un point de vue technique, il s’agit de créer une transaction dite <em>anyone-can-pay</em> («&nbsp;tout le monde peut payer&nbsp;») où la signature de chaque contributeur ne prend en compte que la sortie transactionnelle de la levée de fonds et l’entrée du contributeur en question, donnant la possibilité d’ajouter des entrées (voir figure&nbsp;<a href="#fig:sighash-anyonecanpay" data-reference-type="ref" data-reference="fig:sighash-anyonecanpay">13.2</a>). La transaction résultante n’est valide que si le montant en entrée atteint le montant indiqué en sortie, de sorte que les contributeurs conservent le contrôle de leurs fonds jusqu’à la réalisation du paiement total et peuvent se retirer à tout moment.</p>
<div id="fig:sighash-anyonecanpay" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/sighash-anyonecanpay.png" class="img-fluid figure-img"></p>
<figcaption>Transaction de financement participatif.</figcaption>
</figure>
</div>
<p>Dans le monde du logiciel libre, ce type de financement participatif est particulièrement important, car il n’y a pas de privilège lié à l’écriture du code qui permette de gagner sa vie par la vente de licences. C’est encore plus vrai dans le monde de la cryptomonnaie qui dépend fortement du bon maintien des implémentations logicielles. C’est pourquoi Mike Hearn, qui s’intéressait de près aux capacités de programmation de Bitcoin, s’est vite approprié cette possibilité pour déployer de tels «&nbsp;contrats de garantie&nbsp;» (<em>assurance contracts</em>) permettant de financer les biens publics. Il a mis le concept en œuvre au sein de son application Lighthouse, dont une version fonctionnelle est sortie en 2015, qui avait pour but de faciliter le soutien communautaire des projets de l’écosystème. Avec le déclenchement de la guerre des blocs, ce projet a été mis de côté par Hearn et a fini par être abandonné. Le procédé a été néanmoins repris sur Bitcoin Cash en 2020 par l’intermédiaire de Flipstarter, qui a permis de lever d’importantes sommes pour le financement de l’infrastructure logicielle du protocole.</p>
</section>
<section id="léchange-atomique" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="léchange-atomique">L’échange atomique</h3>
<p>L’échange atomique (<em>atomic swap</em>) est une manière sûre d’échanger deux cryptomonnaies fonctionnant sur des chaînes de blocs différentes, sans passer par un intermédiaire de confiance. L’adjectif «&nbsp;atomique&nbsp;» se rapporte à la nature insécable (en grec ancien <span lang="el">ἄtomos</span>, átomos) de l’échange&nbsp;: soit les deux parties transfèrent leur dû, soit il ne se passe rien. Le concept a été décrit par Sergio Lerner et Gregory Maxwell en juillet 2012 sur le forum Bitcointalk<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Sergio Demian Lerner, <em>P2PTradeX: P2P Trading between cryptocurrencies</em>, 05/07/2012 23:49:48 UTC&nbsp;: <a href="https://bitcointalk.org/index.php?topic=91843.msg1011737#msg1011737" class="uri">https://bitcointalk.org/index.php?topic=91843.msg1011737#msg1011737</a>&nbsp;; Gregory Maxwell, <em>Re: P2PTradeX: P2P Trading between cryptocurrencies</em>, 06/07/2012 02:17:02 UTC&nbsp;: <a href="https://bitcointalk.org/index.php?topic=91843.msg1011956#msg1011956" class="uri">https://bitcointalk.org/index.php?topic=91843.msg1011956#msg1011956</a>.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;Pour assurer la bonne exécution du contrat (éviter le remplacement de la transaction durant l’attente de confirmation), des clés publiques sont assignées à chacune de ces conditions de sorte qu’une signature est systématiquement demandée au destinataire des fonds.</p></div></div><p>L’échange atomique repose sur le concept de contrat verrouillé par une empreinte et par un temps, appelé HTLC par abréviation du terme anglais <em>Hash Time Locked Contract</em>. Celui-ci est un contrat à deux clauses, c’est-à-dire que les fonds peuvent être déverrouillés à deux conditions<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>&nbsp;:</p>
<ul>
<li><p>L’accord mutuel&nbsp;: la révélation d’un secret qui est haché par une fonction de hachage et comparé à l’empreinte (<em>hash</em>) inscrite dans le contrat&nbsp;;</p></li>
<li><p>Le litige&nbsp;: l’attente d’un certain temps (<em>time</em>) de verrouillage déterminé dans le contrat.</p></li>
</ul>
<p>Considérons l’exemple d’un échange atomique entre Alice, qui possède du BTC, et Bob, qui possède du LTC. Alice (<em>maker</em>) propose d’échanger 0,03 BTC pour 10&nbsp;LTC, à un taux de change de 0,003&nbsp;LTC par BTC, et Bob (<em>taker</em>) accepte cet échange. Cette négociation peut avoir lieu par le biais d’un carnet d’ordres public ou privé. Alice choisit au hasard un secret (noté <span class="math inline">\(s\)</span>), qui est un nombre de 32 octets, dont elle fournit l’empreinte cryptographique <span class="math inline">\(H(s)\)</span> à Bob. Ils peuvent ainsi construire un contrat chacun de leur côté pour effectuer l’échange atomique. Son déroulé est décrit au sein de la figure&nbsp;<a href="#fig:atomic-swap-contract" data-reference-type="ref" data-reference="fig:atomic-swap-contract">13.3</a>.</p>
<p>La première phase est la phase d’engagement. D’abord, Alice construit, signe et diffuse une transaction d’engagement envoyant 0,03 BTC vers le contrat d’échange atomique sur la chaîne de Bitcoin. Elle fournit son contenu et son adresse à Bob pour qu’il en vérifie la validité. Puis, elle construit et signe une transaction de remboursement dépensant les fonds de ce contrat qu’elle pourra diffuser après un délai prédéfini (ici 16 heures). Ensuite, une fois que la transaction d’engagement d’Alice a été confirmée, Bob fait de même de son côté&nbsp;: il crée un contrat équivalent sur la chaîne de Litecoin, où il envoie 10&nbsp;LTC, et en donne le contenu et l’adresse à Alice pour qu’elle s’assure que tout est en ordre. Enfin, il construit et signe une transaction qui le remboursera au bout d’un délai strictement inférieur à celui de la transaction d’Alice&nbsp;: ici 8 heures. Cette différence résulte du rapport déséquilibré qui existe entre Alice (qui connaît le secret de déverrouillage) et Bob (qui ne le connaît pas).</p>
<p>Lorsque les transactions d’engagement ont toutes deux été confirmées sur leurs chaînes respectives, la seconde phase de l’échange atomique, la phase de collecte, peut commencer. Alice construit, signe et diffuse une transaction de collecte qui lui permet de récupérer les 10&nbsp;LTC de Bob. Pour cela, elle fournit le secret au sein de la transaction et, ce faisant, le révèle nécessairement à Bob. Finalement, Bob peut lui aussi construire, signer et diffuser une transaction qui lui octroie les 0,03 BTC sur son compte. De cette manière, l’échange est clos&nbsp;!</p>
<div id="fig:atomic-swap-contract" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/atomic-swap-contract.png" class="img-fluid figure-img"></p>
<figcaption>Contrats et transactions dans un échange atomique.</figcaption>
</figure>
</div>
<p>Ce modèle garantit qu’aucun des deux participants ne peut se rembourser avant la fin du temps de verrouillage de Bob (8 heures)&nbsp;; qu’Alice ne peut pas faire valoir sa transaction de remboursement au moment de la diffusion de sa transaction de collecte&nbsp;; et que Bob ne peut pas s’approprier des fonds d’Alice tant qu’elle n’a pas diffusé sa transaction de collecte. Ces garanties rendent le procédé logiquement sécurisé, même si certains évènements perturbateurs peuvent survenir comme une augmentation des temps de confirmation liée à la volatilité du marché des frais.</p>
<p>Le premier <em>atomic swap</em> réel a été réalisé entre Litecoin et Decred le 19 septembre 2017 par Charlie Lee et Alex Yocom-Piatt<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Aujourd’hui, les échanges atomiques sont rares, les carnets d’ordres de plateformes spécialisées comme AtomicDEX étant très peu fournis. Toutefois, avec le durcissement réglementaire sévissant dans l’écosystème et rendant les plateformes centralisées moins fiables, il n’est pas exclu qu’ils jouent un rôle majeur à l’avenir.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;Les adresses des contrats sur LTC et DCR étaient (respectivement) MLp49daA411aoZ1TmGEdyLuTCE9YA6xhpc et DccPF1yt9cV8vhr97fq3umBx7RqV53MYGDY. L’échange était de 1,337 LTC contre 2,4066 DCR. – <em>Decred-compatible cross-chain atomic swapping</em>, 20 septembre 2017&nbsp;: <a href="https://github.com/decred/atomicswap/blob/master/README.md#first-mainnet-dcr-ltc-atomic-swap" class="uri">https://github.com/decred/atomicswap/blob/master/README.md#first-mainnet-dcr-ltc-atomic-swap</a>.</p></div></div></section>
</section>
<section id="les-canaux-de-paiement" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="les-canaux-de-paiement">Les canaux de paiement</h2>
<p>Un cas particulier de l’application des contrats autonomes dans Bitcoin est le déploiement de canaux de paiement. Un canal de paiement est une manière pour deux utilisateurs d’effectuer des paiements répétés en bitcoins de manière sûre et instantanée sans publier de transactions sur la chaîne de blocs à partir de liquidités préalablement bloquées. Ces canaux sont notamment à la base du réseau Lightning, construit en surcouche de la chaîne.</p>
<section id="les-canaux-de-paiement-de-poon-dryja" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="les-canaux-de-paiement-de-poon-dryja">Les canaux de paiement de Poon-Dryja</h3>
<p>Même si l’idée d’un canal de paiement était envisagée dès les origines, elle ne s’est concrétisée qu’avec le concept élaboré par Joseph Poon et Thaddeus Dryja dans le cadre de leur projet du réseau Lightning<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>. Il s’agit d’un concept de canal bidirectionnel dont la sécurité repose sur un mécanisme de punition. Les deux participants bloquent des fonds dans un contrat et peuvent procéder à des paiements l’un vers l’autre dans la limite des liquidités disponibles. La somme des deux soldes des participants est appelée la capacité du canal.</p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Joseph Poon et Thaddeus Dryja, <em>The Bitcoin Lightning Network DRAFT Version 0.5</em>, 28 février 2015&nbsp;: <a href="https://lightning.network/lightning-network-paper-DRAFT-0.5.pdf" class="uri">https://lightning.network/lightning-network-paper-DRAFT-0.5.pdf</a>.</p></div></div><p>Un canal traverse trois phases au cours de son existence&nbsp;:</p>
<ul>
<li><p>La phase d’ouverture ou d’installation, lors de laquelle les fonds sont bloqués par les participants sur un contrat autonome de multisignature 2-parmi-2&nbsp;;</p></li>
<li><p>La phase de négociation ou de mise à jour, durant laquelle la répartition des fonds au sein du canal est ajustée&nbsp;;</p></li>
<li><p>La phase de fermeture ou de règlement, au cours de laquelle les fonds sont distribués aux participants sur la chaîne, généralement de manière coopérative selon le dernier état du canal.</p></li>
</ul>
<p>La répartition initiale et la mise à jour du canal se font par l’intermédiaire de transactions d’engagement qui sont échangées entre les participants et <em>qui ne sont pas diffusées</em> sur le réseau, sauf dans le cas d’un litige, c’est-à-dire d’une fermeture non coopérative. Ces transactions d’engagement sont asymétriques, dans le sens où les participants en possèdent chacun leur propre version.</p>
<p>Supposons qu’Alice et Bob possèdent un canal, tel qu’illustré sur la figure&nbsp;<a href="#fig:poon-dryja-contracts" data-reference-type="ref" data-reference="fig:poon-dryja-contracts">13.4</a>. Dans ce cas, la dernière transaction d’engagement d’Alice, qui peut uniquement être finalisée et diffusée par Bob, prend en compte l’état actualisé du canal et répartit les fonds entre l’adresse d’Alice et un contrat de réclamation. Ce contrat de réclamation contient deux clauses&nbsp;:</p>
<ul>
<li><p>La récupération des fonds par Bob au terme d’un temps de verrouillage, ce qui répartit les fonds selon les soldes indiqués dans le canal&nbsp;;</p></li>
<li><p>La récupération des fonds par Alice à l’aide d’une clé de révocation qui est révélée plus tard lorsque le canal est de nouveau mis à jour.</p></li>
</ul>
<p>Si un paiement a lieu d’Alice vers Bob, la mise à jour du canal se fait de la manière suivante. Alice construit et signe sa transaction d’engagement en utilisant la clé publique de révocation de Bob que ce dernier lui a transmise au préalable. Seul Bob peut finaliser la signature de cette transaction et la diffuser sur le réseau. Bob lui répond en lui envoyant sa clé privée de révocation, ce qui rend la dernière transaction d’engagement d’Alice inopérante. La même chose se produit ensuite de manière symétrique&nbsp;: Bob construit et signe sa transaction d’engagement qu’il transmet à Alice, et cette dernière lui révèle en échange sa clé privée de révocation, ce qui rend la transaction d’engagement de Bob impuissante<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;Andreas M. Antonopoulos, Olaoluwa Osuntokun, René Pickhardt, «&nbsp;Payment Channels&nbsp;», in <em>Mastering the Lightning Network: A Second Layer Blockchain Protocol for Instant Bitcoin Payments</em>, O’Reilly Media, 2022, pp.&nbsp;149–184.</p></div></div><p>La révélation de la clé de révocation à chaque étape de mise à jour rend possible l’activation d’un mécanisme de punition à tout moment. Si l’une des deux parties diffuse une transaction d’engagement correspondant à un état antérieur du canal, alors l’autre peut récupérer <em>l’intégralité</em> des fonds du canal. Par exemple, Alice pourrait récupérer les fonds de Bob si ce dernier était amené à diffuser le précédent état du canal dans le but d’«&nbsp;annuler&nbsp;» le dernier paiement réalisé.</p>
<div id="fig:poon-dryja-contracts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/lightning-poon-dryja-channel-contracts.png" class="img-fluid figure-img"></p>
<figcaption>Contrats et transactions dans un canal de paiement de Poon-Dryja&nbsp;: cas d’un paiement de Bob de 2&nbsp;mBTC à Alice.</figcaption>
</figure>
</div>
<p>Le défaut principal de ce mécanisme de punition est qu’il faut surveiller le réseau en permanence pour éviter un vol, ce qui se fait avec un nœud complet ou bien avec un tiers de confiance bien choisi («&nbsp;tour de garde&nbsp;» ou «&nbsp;<em>watchtower</em>&nbsp;»).</p>
<p>Ce fonctionnement des canaux de Poon-Dryja fait aussi que toute erreur est très pénalisante&nbsp;: la diffusion accidentelle d’une transaction d’engagement antérieure mène à la récupération des fonds par l’autre partie. Il a également d’autres défauts&nbsp;: il impose de conserver l’ensemble des états antérieurs du canal, il oblige les participants à choisir les frais des transactions à l’avance et il alourdit considérablement les innovations au sein du réseau Lightning. C’est par volonté d’améliorer cette situation qu’ont été conceptualisés les canaux dits «&nbsp;de Decker-Russell-Osuntokun&nbsp;».</p>
</section>
<section id="les-canaux-de-paiement-de-decker-russell-osuntokun" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="les-canaux-de-paiement-de-decker-russell-osuntokun">Les canaux de paiement de Decker-Russell-Osuntokun</h3>
<p>Les canaux de paiement de Decker-Russell-Osuntokun ont été décrits par Christian Decker, Rusty Russell et Olaoluwa Osuntokun dans un livre blanc publié en avril 2018<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. Le protocole sous-jacent est appelé Eltoo, qui est une déformation de l’anglais «&nbsp;<em>L2</em>&nbsp;» (signifiant <em>layer two</em>).</p>
<div class="no-row-height column-margin column-container"><div id="fn10"><p><sup>10</sup>&nbsp;Christian Decker, Rusty Russell, Olaoluwa Osuntokun, <em>eltoo: A Simple Layer2 Protocol for Bitcoin</em>, 30 avril 2018&nbsp;: <a href="https://blockstream.com/eltoo.pdf" class="uri">https://blockstream.com/eltoo.pdf</a>.</p></div></div><p>Le fonctionnement des canaux de Decker-Russel-Osuntokun se base sur une chaîne de transactions, qui ne sont pas censées être diffusées sur la chaîne, sauf celles d’ouverture et de fermeture (cf.&nbsp;figure&nbsp;<a href="#fig:eltoo" data-reference-type="ref" data-reference="fig:eltoo">13.5</a>). Le principe est le suivant&nbsp;:</p>
<ul>
<li><p>Le canal est ouvert par une transaction d’ouverture (<span class="math inline">\(T_{u,0}\)</span>), préalablement garantie par une transaction de règlement (<span class="math inline">\(T_{s,0}\)</span>) qui rembourse les participants en cas de litige&nbsp;;</p></li>
<li><p>Le canal est mis à jour par des transactions de mise à jour (<span class="math inline">\(T_{u,i}\)</span>) qui invalident les transactions de règlement précédentes (<span class="math inline">\(T_{s,i-1}\)</span>)&nbsp;;</p></li>
<li><p>La fermeture du canal peut se faire après un certain délai d’expiration par la diffusion de la dernière transaction de règlement (<span class="math inline">\(T_{s,i}\)</span>).</p></li>
</ul>
<p>Ici il n’y a plus besoin de recourir à des clés de révocation pour rendre les anciens états du canal inexploitables&nbsp;: ce sont les transactions elles-mêmes qui ont ce rôle. Eltoo fait intervenir ce qu’on appelle des transactions flottantes, qui peuvent dépenser les fonds issus de n’importe quelle transaction de mise à jour précédente. De cette manière, chaque transaction de mise à jour est flottante, ainsi que chaque transaction de règlement, ce qui permet d’omettre toutes les mises à jour précédentes. De plus, un numéro d’état est inscrit dans chaque transaction pour ordonner les transactions et ainsi éviter la diffusion d’un état antérieur.</p>
<div id="fig:eltoo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/eltoo-offchain-protocol.png" class="img-fluid figure-img"></p>
<figcaption>Aperçu du protocole Eltoo.</figcaption>
</figure>
</div>
<p>Une transaction supplémentaire est ajoutée à la chaîne de transactions pour éviter que le délai d’expiration des transactions de règlement <span class="math inline">\(T_{s,i}\)</span> soit atteint et qu’elles soient diffusées sur la chaîne. Cette transaction envoie simplement les fonds vers un compte multisignatures classique, et est signée et diffusée après la signature des premières transactions de mise à jour et de règlement (<span class="math inline">\(T_{u,0}\)</span> et <span class="math inline">\(T_{s,0}\)</span>). Le délai d’expiration ne commence que lorsque la transaction <span class="math inline">\(T_{u,0}\)</span> est diffusée.</p>
<p>Ce fonctionnement permet d’obtenir un protocole simple de mise à jour du canal, peu contraignant pour les nœuds, sans mécanisme de punition, et permettant de ne pas à avoir à décider les frais à l’avance. Cette facilité d’implémentation pourrait rendre plus aisée la création de contrats plus complexes sur Lightning, comme les canaux de paiement à 3 participants ou plus. En outre, leur implémentation ne doit en aucun cas remplacer celle des canaux de Poon-Dryja&nbsp;: les deux modèles peuvent coexister au sein d’un seul et même réseau de canaux de paiement.</p>
<p>Les transactions flottantes sont implémentées à l’aide de SIGHASH_ANYPREVOUT. La mise en œuvre de Eltoo repose donc sur l’intégration du BIP-118 dans Bitcoin.</p>
</section>
</section>
<section id="linscription-de-données-arbitraires" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="linscription-de-données-arbitraires">L’inscription de données arbitraires</h2>
<p>Bitcoin permet d’inscrire des données non financières sur la chaîne, c’est-à-dire des données qui ne sont pas nécessaires dans le blocage et le déblocage des fonds et qui sont interprétées de manière extérieure au protocole. Même en imposant toutes les restrictions possibles, on ne peut pas empêcher l’inscription de ces données, même s’il est possible de la rendre plus coûteuse.</p>
<p>La chaîne de blocs de la version principale de Bitcoin est largement partagée autour du monde, et sera conservée par l’humanité, au moins comme un reliquat historique, laissant supposer que ce qui y est stocké sera conservé très longtemps. Cette caractéristique pousse les gens à y inclure des choses qui leur tiennent à cœur. Il est dans la nature de l’homme de chercher à laisser des traces de son passage sur Terre et écrire sur un registre réputé immuable est une manière de le faire.</p>
<p>Il existe diverses méthodes d’inscription, qui ont chacune leurs qualités et leurs défauts. Celles-ci ont évolué au fur et à mesure des années, alors que cette utilisation se libéralisait.</p>
<p>D’une part, l’écriture de données arbitraires peut être réalisée par les mineurs au sein de l’entrée de transaction de récompense, et plus précisément dans le script de déverrouillage. Ce champ est en effet superflu conceptuellement, la base de pièce ne faisant référence à aucune sortie existante, et peut donc être exploité de manière discrétionnaire. C’est cette méthode dont Satoshi Nakamoto a fait usage pour inscrire le désormais célèbre titre de une du Times du 3 janvier 2009 dans le bloc de genèse&nbsp;:</p>
<p><em>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</em></p>
<p>D’autres blocs contiennent des messages emblématiques. Le bloc d’exode de BCH (de hauteur 478&nbsp;559) contenait un message de bienvenue pour Shuya Yang, la fille du PDG de la coopérative ViaBTC. Le bloc précédant le troisième halving sur BTC en 2020 (de hauteur 629&nbsp;999) incluait le titre d’un article du New York Times du 9 avril annonçant l’injection de liquidité record de la Réserve Fédérale (2&nbsp;300 milliards de dollars) en réaction à la crise du Covid-19&nbsp;: «&nbsp;<em>NYTimes 09/Apr/2020 With $2.3T Injection, Fed’s Plan Far Exceeds 2008 Rescue</em>&nbsp;».</p>
<p>Le script de déverrouillage de la base de pièce peut être utilisé pour écrire d’autres données. C’est le cas du nonce supplémentaire (le critère qui a permis d’identifier les bitcoins de Satoshi). C’est aussi le cas du signalement des coopératives minières qui est réalisé via ce champ&nbsp;: par exemple, la base de pièce du bloc 751&nbsp;005 contient la chaîne de caractères poolin.com, ce qui indique que sa validation a probablement été réalisée par la coopérative chinoise Poolin.</p>
<p>D’autre part, l’inscription des données arbitraires peut aussi être le fait des utilisateurs, qui peuvent les inclure dans leurs transactions et payer les frais correspondants. Plusieurs méthodes ont été exploitées pour ce faire.</p>
<p>Avant 2014, on procédait la plupart du temps à ces inscriptions en stockant les données dans les scripts de verrouillage, par exemple par l’utilisation de l’instruction de dépilement <code>OP_DROP</code><a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. Une autre pratique courante était d’inscrire les données dans les sorties de type P2PKH, qui étaient rendues indépensables au passage. Cette méthode était extrêmement coûteuse en raison de la forme de la transaction (imposant l’inscription dans les sorties transactionnelles) et le fait de devoir envoyer des montants non nuls en sortie. Elle était également dommageable pour le système dans son ensemble, car elle encombrait l’ensemble des UTXO.</p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;La transaction c0b2cf75b47d1e7f48cdb4287109ff1dd5bcf146d5f77a9e8784c0c9c0ef02ad, confirmée le 13 décembre 2012, contient par exemple la chaîne de caractères TheCakeIsALie\n en référence au jeu vidéo Portal.</p></div><div id="fn12"><p><sup>12</sup>&nbsp;Bitcoin Core, <em>Bitcoin Core version 0.9.0 released</em>, 19 mars 2014&nbsp;: <a href="https://bitcoin.org/en/release/v0.9.0#opreturn-and-data-in-the-block-chain" class="uri">https://bitcoin.org/en/release/v0.9.0#opreturn-and-data-in-the-block-chain</a>.</p></div></div><p>Après 2014, une manière plus efficace de stocker des données a été autorisée par le biais de la standardisation du schéma NULLDATA qui se basait sur l’instruction <code>OP_RETURN</code>. Ce changement permettait de créer «&nbsp;une sortie assurément élagable, pour éviter les schémas de stockage d’informations [...] qui enregistraient des données arbitraires, telles que des images, en tant que sorties transactionnelles éternellement indépensables, gonflant ainsi la base de données des UTXO de bitcoin<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>&nbsp;». Il limitait aussi le gaspillage de fonds en autorisant la création d’une sortie de 0 satoshi. Ce schéma s’est rapidement imposé comme la manière la plus populaire pour publier des informations sur la chaîne.</p>
<p>En outre, il est aussi possible de stocker des données au sein des entrées transactionnelles ou des témoins liés, lors de la dépense de sorties P2SH, P2WSH ou P2TR. Cette écriture peut se faire dans les scripts de récupération ou bien dans les éléments de déverrouillage. Cette méthode a l’avantage de ne pas surcharger l’ensemble des UTXO. Côté utilisateur, pour les entrées où SegWit s’applique, elle a pour bénéfice de diviser le coût des données arbitraires inscrites dans la transaction par quatre.</p>
<p>Ces différentes méthodes ont été utilisées pour inscrire toutes sortes de choses sur la chaîne, dont notamment des empreintes cryptographiques, du texte et des images<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn13"><p><sup>13</sup>&nbsp;Ken Shirriff, <em>Hidden surprises in the Bitcoin blockchain and how they are stored: Nelson Mandela, Wikileaks, photos, and Python software</em>, 16 février 2014&nbsp;: <a href="https://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html" class="uri">https://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html</a>.</p></div><div id="fn14"><p><sup>14</sup>&nbsp;Hal Finney, <em>Re: [bitcoin-list] Bitcoin v0.1.5 released</em>, 27/02/2009 20:00:12 UTC, archive&nbsp;: <a href="https://web.archive.org/web/20131016004925/http://sourceforge.net/p/bitcoin/mailman/bitcoin-list/?viewmonth=200902" class="uri">https://web.archive.org/web/20131016004925/http://sourceforge.net/p/bitcoin/mailman/bitcoin-list/?viewmonth=200902</a>.</p></div></div><p>D’abord, on peut inscrire une empreinte, l’inscription servant alors à l’horodatage. Il s’agit d’inscrire l’empreinte d’un fichier sur la chaîne en tant que preuve d’existence. Cette idée a été mise en avant en février 2009 par Hal Finney dans un de ses courriels adressés à la liste de diffusion dédiée à Bitcoin. Il suggérait alors que «&nbsp;la pile de blocs de bitcoin serait parfaite&nbsp;» pour «&nbsp;prouver qu’un certain document a existé à un certain moment dans le passé<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>&nbsp;», un point de vue approuvé par Satoshi. En somme, cette pratique permet de démontrer la connaissance d’une information avant sa publication, et donc indirectement qu’on en est l’auteur probable. Ce type d’usage a notamment été mis en œuvre par l’entreprise française Woleet.</p>
<p>Cette possibilité peut aussi être exploitée par les systèmes décentralisés d’hébergement de fichiers, comme le système IPFS (InterPlanetary File System) qui utilise les empreintes des fichiers pour les identifier et permettre leur stockage par un réseau pair à pair d’utilisateurs. Il est donc possible d’associer le texte écrit sur la chaîne de blocs et des images ou des vidéos, hébergées de manière décentralisée.</p>
<p>Ensuite, on peut inscrire un texte, qui est généralement encodé en ASCII / UTF-8. Par exemple, la phrase «&nbsp;La beauté sauvera le monde.&nbsp;» a été inscrite sur la chaîne de BTC le 10 août 2022 dans la transaction d’identifiant 08e5ce0783ab6d5534e234136df02e0e240f76108eb6af04b8b624646b66f5eb. L’inscription de textes permet aussi de dessiner des images en art ASCII. C’est le cas de l’hommage à Len Sassaman (voir figure&nbsp;<a href="#fig:sassaman-tribute" data-reference-type="ref" data-reference="fig:sassaman-tribute">13.6</a>), décédé en juillet 2011, qui a été inscrit sur la chaîne par les développeurs Dan Kaminsky et Travis Goodspeed dans des sorties P2PKH, et qui contient notamment une représentation de l’ancien président de la Fed, Ben Bernanke.</p>
<figure id="fig:sassaman-tribute" class="figure">
<pre data-fontsize="\footnotesize"><code>---BEGIN TRIBUTE---  =-=-=-=-=-=-=-=-=-=     ASCII BERNANKE
        #./BitLen            LEN "rabbi" SASSAMA  :'::.:::::.:::.::.:
        :::::::::::::::::::       1980-2011       : :.: ' ' ' ' : :':
        :::::::.::.::.:.:::  Len was our friend.  :.:     _.__    '.:
        :.: :.' ' ' ' ' : :  A brilliant mind,    :   _,^"   "^x,   :
        :.:'' ,,xiW,"4x, ''  a kind soul, and     '  x7'        `4,
        :  ,dWWWXXXXi,4WX,   a devious schemer;    XX7            4XX
        ' dWWWXXX7"     `X,  husband to Meredith   XX              XX
         lWWWXX7   __   _ X  brother to Calvin,    Xl ,xxx,   ,xxx,XX
        :WWWXX7 ,xXX7' "^^X  son to Jim and       ( ' _,+o, | ,o+,"
        lWWWX7, _.+,, _.+.,  Dana Hartshorn,       4   "-^' X "^-'" 7
        :WWW7,. `^"-" ,^-'   coauthor and          l,     ( ))     ,X
         WW",X:        X,    cofounder and         :Xx,_ ,xXXXxx,_,XX
         "7^^Xl.    _(_x7'   Shmoo and so much      4XXiX'-___-`XXXX'
         l ( :X:       __ _  more.  We dedicate      4XXi,_   _iXX7'
         `. " XX  ,xxWWWWX7  this silly hack to     , `4XXXXXXXXX^ _,
          )X- "" 4X" .___.   Len, who would have    Xx,  ""^^^XX7,xX
        ,W X     :Xi  _,,_   found it absolutely  W,"4WWx,_ _,XxWWX7'
        WW X      4XiyXWWXd  hilarious.           Xwi, "4WW7""4WW7',W
        "" ,,      4XWWWWXX  --Dan Kaminsky,      TXXWw, ^7 Xk 47 ,WH
        , R7X,       "^447^  Travis Goodspeed     :TXXXWw,_ "), ,wWT:
        R, "4RXk,      _, ,  P.S.  My apologies,  ::TTXXWWW lXl WWT:
        TWk  "4RXXi,   X',x  BitCoin people.  He  ----END TRIBUTE----
        lTWk,  "4RRR7' 4 XH  also would have
        :lWWWk,  ^"     `4   LOL'd at BitCoin's
        ::TTXWWi,_  Xll :..  new dependency upon</code></pre>
<figcaption>
Hommage à Len Sassaman (art ASCII).
</figcaption>
</figure>
<p>Enfin, on peut inclure une image, qui peut être encodée dans de multiples formats, dont notamment en JPEG ou en PNG. Un logo Bitcoin inscrit le 13 mai 2011 peut par exemple être retrouvé. Un hommage à Nelson Mandela accompagné d’une photo a été publié le 7 décembre 2013, quelques jours après sa mort. En 2022, l’absence de restriction standarde sur la taille des scripts de Taproot a permis de réaliser des inscriptions volumineuses d’une manière bien plus transparente et directe. C’est ce qui a notamment permis d’inscrire l’image des Taproot Wizards qui pesait quasiment 4&nbsp;Mo (voir figure&nbsp;<a href="#fig:taproot-wizards" data-reference-type="ref" data-reference="fig:taproot-wizards">13.7</a>).</p>
<div id="fig:taproot-wizards" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/taproot-wizards-small-0301e0480b374b32851a9462db29dc19fe830a7f7d7a88b81612b9d42099c0aei0.jpg" class="img-fluid figure-img"></p>
<figcaption>Image (réduite) des Taproot Wizards.</figcaption>
</figure>
</div>
<p>De manière générale, tout format de fichier peut être stocké sur la chaîne au moyen de transactions multiples&nbsp;: un document, un livre, une vidéo, un jeu, etc. Cependant, cette utilisation n’est pas forcément toujours pertinente. L’inscription demande le paiement de frais, parfois élevés, et la chaîne de blocs de BTC n’est pas franchement faite pour conserver des données volumineuses. La publication de ces fichiers sur IPFS et sur serveur local est généralement bien plus opportune.</p>
<p>Notons que la communauté de Bitcoin SV s’est focalisée sur le stockage de données, considérant que son registre était une «&nbsp;source universelle de vérité<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>&nbsp;». On peut ainsi retrouver un volume assez important de données météorologiques sur sa chaîne, qui y sont inscrites depuis 2019. Cela fait que le réseau BSV est extrêmement centralisé tant du point de vue minier que commercial, ce qui remet en cause l’utilité première de l’inscription d’informations sur une chaîne de blocs&nbsp;: l’immuabilité.</p>
<div class="no-row-height column-margin column-container"><div id="fn15"><p><sup>15</sup>&nbsp;CoinGeek, <em>Jerry Chan: Bitcoin’s value is as a universal source of truth</em>, 17 juillet 2019&nbsp;: <a href="https://coingeek.com/jerry-chan-bitcoins-value-is-as-a-universal-source-of-truth-video/" class="uri">https://coingeek.com/jerry-chan-bitcoins-value-is-as-a-universal-source-of-truth-video/</a>.</p></div></div></section>
<section id="les-métaprotocoles" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="les-métaprotocoles">Les métaprotocoles</h2>
<p>Les métaprotocoles sont des protocoles qui se servent du protocole de base pour fonctionner. Ils font usage de l’inscription de données arbitraires sur la chaîne pour inclure des instructions qui sont interprétées par des implémentations logicielles spécifiques. Ils ont pour particularité d’être plus extensifs que le protocole de base.</p>
<p>Il ne s’agit pas d’une idée nouvelle. Dès les premières années d’existence de Bitcoin, certaines personnes ont souhaité l’exploiter plus en profondeur, en se servant de lui d’une autre manière que comme un instrument de transfert de valeur. Ce mouvement initial, visant à ajouter des fonctionnalités à Bitcoin de cette façon, était appelé «&nbsp;Bitcoin 2.0&nbsp;». Il a finalement mené à l’élaboration d’Ethereum à partir de 2013.</p>
<p>Le premier type de métaprotocole qui a été élaboré est le procédé des <em>colored coins</em>, ou pièces colorées en français, qui consiste à marquer des pièces (UTXO) par l’inscription annexe de données, comme montré sur la figure&nbsp;<a href="#fig:colored-coin" data-reference-type="ref" data-reference="fig:colored-coin">13.8</a>. Chaque type de jeton créé est lié à un identifiant, que l’on peut assimiler à une couleur, d’où le nom de ce procédé. L’idée a été présentée en 2012 par Yoni Assia et Meni Rosenfeld<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn16"><p><sup>16</sup>&nbsp;Yoni Assia, <em>bitcoin 2.X (aka Colored Bitcoin) – initial specs</em>, 27 mars 2012&nbsp;: <a href="https://yoniassia.com/coloredbitcoin/" class="uri">https://yoniassia.com/coloredbitcoin/</a>&nbsp;; Meni Rosenfeld, <em>Overview of Colored Coins</em>, 4 décembre 2012&nbsp;: <a href="https://bitcoil.co.il/BitcoinX.pdf" class="uri">https://bitcoil.co.il/BitcoinX.pdf</a>.</p></div></div><div id="fig:colored-coin" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/colored-coin.png" class="img-fluid figure-img"></p>
<figcaption>Création et transfert d’un jeton émis sous la forme d’un colored coin.</figcaption>
</figure>
</div>
<p>L’implémentation de ce concept a été réalisée dès la fin de l’année 2012 par l’intermédiaire du ChromaWallet. Cependant, elle n’a vraiment pris de l’ampleur qu’à partir de 2014, avec l’apparition des Open Assets de Coinprism, des <em>CoinSpark assets</em> de Coin Sciences, et des Colored Coins de Colu. Ces usages sont depuis tombés en désuétude, même si le procédé a pu servir de manière sporadique au fil des années, comme dans le cas du jeton BSQ de Bisq créé en 2018 comme base de sa DAO. Une tentative de restauration a également été faite sur Bitcoin Cash avec les jetons SLP, sans grand succès.</p>
<p>Au-delà des pièces colorées, il existait des protocoles plus évolués qui avaient la particularité de gérer une unité de compte propre. Il s’agissait essentiellement de Mastercoin, qui a été rebaptisé Omni en mars 2015, et de Counterparty.</p>
<p>Le premier métaprotocole avancé a été Mastercoin, dont le livre blanc, intitulé «&nbsp;<em>The Second Bitcoin Whitepaper</em>&nbsp;», a été publié le 6 janvier 2012 par J.R. Willett<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>. Il s’agissait d’un protocole permettant à ses utilisateurs de créer leurs propres devises, appelées «&nbsp;<em>user currencies</em>&nbsp;». Mastercoin reposait sur une unité de compte notée le MSC, qui a fait l’objet d’une prévente d’un mois en juillet-août 2013<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>. C’était la première <em>Initial Coin Offering</em> de l’histoire, et elle a recueilli 5&nbsp;120&nbsp;BTC, soit plus de 500&nbsp;000&nbsp;$ à ce moment-là.</p>
<div class="no-row-height column-margin column-container"><div id="fn17"><p><sup>17</sup>&nbsp;J.R. Willett, <em>The Second Bitcoin Whitepaper</em>, 6 janvier 2012, archive&nbsp;: <a href="https://cryptochainuni.com/wp-content/uploads/Mastercoin-2nd-Bitcoin-Whitepaper.pdf" class="uri">https://cryptochainuni.com/wp-content/uploads/Mastercoin-2nd-Bitcoin-Whitepaper.pdf</a>.</p></div><div id="fn18"><p><sup>18</sup>&nbsp;Tous les bitcoins envoyés à l’adresse 1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P étaient transformés en MSC à raison de 100&nbsp;MSC au début, taux dégressif au fil des semaines.</p></div></div><p>Le plus grand succès de ce protocole a probablement été la création du premier stablecoin, le Tether USD, qui a été émis sous le nom de Realcoin en octobre 2014. Mastercoin / Omni a longtemps été l’unique manière de posséder et de transférer de l’USDT avant que le jeton ne soit émis massivement sur d’autres chaînes comme Ethereum et Tron.</p>
<p>Le second métaprotocole avancé a été Counterparty, lancé en janvier 2014. Cette plateforme reposait également sur un jeton natif, le XCP, qui lui servait de carburant, et qui a été créé par brûlage de bitcoins durant son premier mois d’existence<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a>. Ce sont 2&nbsp;140 bitcoins qui ont ainsi été rendus inutilisables pour donner vie à plus de 2,6 millions de XCP, encore en circulation aujourd’hui. Counterparty se voulait plus flexible que Mastercoin en rendant possible l’implémentation de contrats autonomes, notamment dans le but de créer des jetons et d’héberger des plateformes d’échange décentralisées, appelées des «&nbsp;distributeurs&nbsp;».</p>
<div class="no-row-height column-margin column-container"><div id="fn19"><p><sup>19</sup>&nbsp;Tous les bitcoins envoyés à l’adresse 1CounterpartyXXXXXXXXXXXXXXXUWLpVr entre le 2 janvier et le 3 février 2014 étaient convertis en XCP à un taux qui variait entre 1&nbsp;000 et 1&nbsp;500 XCP par BTC</p></div><div id="fn20"><p><sup>20</sup>&nbsp;Hal Finney, <em>Crypto trading cards.</em>, 17/01/1993 18:48:02 UTC&nbsp;: <a href="https://cypherpunks.venona.com/date/1993/01/msg00152.html" class="uri">https://cypherpunks.venona.com/date/1993/01/msg00152.html</a>.</p></div></div><p>En particulier, Counterparty a été la première plateforme à proposer la gestion de jetons non fongibles (NFT). Il s’agissait là de mettre en œuvre une vieille idée, qui avait notamment été mise en valeur par Hal Finney en 1993 sur la liste de diffusion cypherpunk sous la forme de «&nbsp;cartes à collectionner cryptographiques<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a>&nbsp;». Counterparty a ainsi hébergé une multitude de collections de tels objets, comme les cartes à jouer de <em>Spells of Genesis</em> et de SaruTobi créées en 2015, ou les Rare Pepes émis entre 2016 et 2018.</p>
<p>En 2018, l’apparition de Bitcoin Cash a motivé la création d’un média social dont les données seraient entièrement stockées sur la chaîne, les développeurs de BCH étant plus libéraux à ce sujet. Le protocole s’appelait Memo et consistait à publier de courts messages visibles publiquement sous un profil défini et à pouvoir suivre les autres utilisateurs, à aimer et répondre à leurs messages. L’idée était d’obtenir une sorte de réseau social résistant à la censure, mais souffrait néanmoins de la nécessité de payer des frais à chaque action.</p>
<p>Tous ces protocoles ont perdu leur attrait jusqu’à l’apparition du protocole Ordinals, lancé en janvier 2023. Ce métaprotocole permettait de créer et de gérer des «&nbsp;artéfacts numériques&nbsp;», c’est-à-dire des NFT dont l’intégralité des données est stockée de manière immuable sur une chaîne résistante à la censure. Le protocole Ordinals reposait sur une «&nbsp;théorie des ordinaux&nbsp;» permettant de suivre et de transférer des satoshis liés à une inscription, comme un texte, une image ou autre chose. En particulier, Ordinals a été utilisé pour émuler la propriété et le transfert de jetons fongibles, baptisés «&nbsp;BRC-20&nbsp;», dont le succès spéculatif a provoqué une congestion du réseau menant à une hausse des frais de transaction historique. Le succès d’Ordinals a également inspiré la création du protocole STAMPS, qui se basait sur Counterparty pour le suivi des artéfacts et stockait leurs données dans des sorties P2MS.</p>
<p>Toutes ces pratiques ont créé des débats. En effet, Bitcoin était présenté comme un modèle de monnaie numérique et il semblait contreproductif d’en faire un protocole de conservation de données qui ne seraient pas relatives au transfert de bitcoins. Ainsi, dès décembre 2010, Jeff Garzik s’opposait au fait d’utiliser la chaîne pour le stockage généralisé<a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a>. Plus tard, en 2014, des disputes similaires ont éclaté au sujet de Counterparty<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a>. En 2023, c’est également la même discorde qui a eu lieu suite au succès d’Ordinals<a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn21"><p><sup>21</sup>&nbsp;Jeff Garzik, <em>Resist the urge to use block chain for generalized storage</em>, 07/12/2010 22:04:54 UTC&nbsp;: <a href="https://bitcointalk.org/index.php?topic=2129.msg27884#msg27884" class="uri">https://bitcointalk.org/index.php?topic=2129.msg27884#msg27884</a>.</p></div><div id="fn22"><p><sup>22</sup>&nbsp;BitMEX Research, <em>The OP_Return Wars of 2014 – Dapps Vs Bitcoin Transactions</em>, 12 juillet 2022&nbsp;: <a href="https://blog.bitmex.com/dapps-or-only-bitcoin-transactions-the-2014-debate/" class="uri">https://blog.bitmex.com/dapps-or-only-bitcoin-transactions-the-2014-debate/</a>.</p></div><div id="fn23"><p><sup>23</sup>&nbsp;pourteaux, <em>Illegitimate bitcoin transactions</em>, 25 janvier 2023&nbsp;: <a href="https://read.pourteaux.xyz/p/illegitimate-bitcoin-transactions" class="uri">https://read.pourteaux.xyz/p/illegitimate-bitcoin-transactions</a>.</p></div></div><p>Ces métaprotocoles présentent deux défauts majeurs. Le premier est que la vérification de leurs règles dépend d’un petit sous-ensemble de nœuds du réseau. En effet, la gestion d’un tel protocole construit en surcouche demande des ressources supplémentaires, notamment en ce qui concerne l’indexation pour les pièces colorées. De ce fait, peu de personnes déploient une implémentation complète, ce qui centralise considérablement le protocole et le rend sensible à l’altération par un adversaire qui aurait pour but de le censurer.</p>
<p>Le second défaut concerne leurs frais d’utilisation parfois très élevés, surtout si la limite de capacité transactionnelle du réseau est atteinte. Les transactions qui mettent en place ces solutions sont nécessairement plus volumineuses que les transactions normales et entraînent par conséquent des frais plus élevés. Elles sont donc plus facilement exclues par l’augmentation des frais issue de la congestion du réseau.</p>
<p>C’est pour ces raisons que les personnes qui ont travaillé sur ces solutions s’en sont vite détournées, préférant se réfugier vers des plateformes alternatives comme NXT et surtout Ethereum. Vitalik Buterin lui-même s’intéressait aux pièces colorées et à Mastercoin en 2013 avant de commencer à bâtir ce qui allait devenir Ethereum<a href="#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a>. C’est aussi pour ces raisons que des solutions moins coûteuses (des surcouches utilisant la chaîne comme un procédé de règlement et non pas comme un lieu où inscrire toutes les opérations) sont aujourd’hui privilégiées pour faire ce genre de choses comme RGB ou Taproot Assets.</p>
<div class="no-row-height column-margin column-container"><div id="fn24"><p><sup>24</sup>&nbsp;Yoni Assia, Vitalik Buterin, Meni Rosenfeld, Rotem Lev, <em>Colored Coins whitepaper</em>, 2013&nbsp;: <a href="http://www.ma.senac.br/wp-content/uploads/2018/05/ColoredCoinswhitepaper-DigitalAssets.pdf" class="uri">http://www.ma.senac.br/wp-content/uploads/2018/05/ColoredCoinswhitepaper-DigitalAssets.pdf</a>&nbsp;; Vitalik Buterin, <em>A Prehistory of the Ethereum Protocol</em>, 14 septembre 2017&nbsp;: <a href="https://vitalik.ca/general/2017/09/14/prehistory.html" class="uri">https://vitalik.ca/general/2017/09/14/prehistory.html</a>.</p></div></div></section>
<section id="les-contrats-hors-chaîne" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="les-contrats-hors-chaîne">Les contrats hors chaîne</h2>
<p>La cryptographie permet de déployer des contrats sans que ceux-ci ne doivent être inscrits sur la chaîne. Cette particularité a été facilitée grâce à la mise à niveau Schnorr-Taproot, souvent simplement appelée «&nbsp;Taproot&nbsp;», qui est survenue sur BTC le 14 novembre 2021 et qui incluait deux éléments majeurs&nbsp;: le schéma de signature de Schnorr et le procédé de programmation de contrats Taproot. Ces fonctionnalités ont été intégrées sous forme d’un soft fork au sein du schéma standard P2TR correspondant à la version 1 de SegWit.</p>
<p>Le schéma de Schnorr implémenté est une dérivation du protocole d’authentification du même nom décrit en 1989 par Claus-Peter Schnorr. Il s’agit d’une alternative à ECDSA qui se base sur la même courbe elliptique (secp256k1) et qui permet de signer des transactions grâce aux mêmes paires de clés.</p>
<p>Comparé à ECDSA, le schéma de signature de Schnorr possède quelques avantages. Premièrement, il produit des signatures moins grandes. Deuxièmement, les signatures produites ne sont pas malléables, le procédé ne faisant pas intervenir de nombre aléatoire. Troisièmement, et c’est le plus important, il présente une propriété de linéarité, ce qui permet notamment de faire des choses comme la vérification par lots et l’agrégation des clés.</p>
<p>Le schéma de Schnorr est supérieur à ECDSA et existait en 2008, mais Satoshi Nakamoto n’a pas daigné s’en servir. Ce choix s’explique par le fait que l’algorithme était breveté aux États-Unis jusqu’en février 2008 et que par conséquent il n’existait pas d’implémentation standardisée. Le logiciel de Bitcoin utilisait en effet OpenSSL, qui n’intégrait pas ce type d’algorithme.</p>
<p>Le schéma de Schnorr autorise le déploiement de <em>Scriptless Scripts</em>, de contrats «&nbsp;sans script&nbsp;» qui sont exécutés en dehors de la chaîne et appliqués au sein des signatures. Le concept a été théorisé en 2017 par Andrew Poelstra<a href="#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a>. Il se retrouve dans des exemples comme le schéma de signature multipartite MuSig2, les <em>Adaptor Signatures</em> ou encore les <em>Discreet Log Contracts</em>.</p>
<div class="no-row-height column-margin column-container"><div id="fn25"><p><sup>25</sup>&nbsp;Andrew Poelstra, <em>Using the Chain for what Chains are Good For</em> (vidéo), Scaling Bitcoin IV, 5 novembre 2017&nbsp;: <a href="https://www.youtube.com/watch?v=3pd6xHjLbhs&amp;t=5755s" class="uri">https://www.youtube.com/watch?v=3pd6xHjLbhs&amp;t=5755s</a>&nbsp;; Aaron van Wirdum, «&nbsp;<em>Scriptless Scripts: How Bitcoin Can Support Smart Contracts Without Smart Contracts</em>&nbsp;», <em>Bitcoin Magazine</em>, 27 novembre 2017&nbsp;: <a href="https://bitcoinmagazine.com/technical/scriptless-scripts-how-bitcoin-can-support-smart-contracts-without-smart-contracts" class="uri">https://bitcoinmagazine.com/technical/scriptless-scripts-how-bitcoin-can-support-smart-contracts-without-smart-contracts</a>.</p></div></div><p>Outre cela, le schéma de Schnorr facilite grandement l’implémentation de Taproot (BIP-341), qui a été intégré au protocole au même moment. Taproot (dont le nom signifie littéralement «&nbsp;racine pivot&nbsp;» en français) est un procédé de programmation de contrats autonomes qui ancre les clauses d’un contrat au sein d’un arbre de Merkle et qui cache cet arbre sous une clé publique agrégée appartenant à ses participants. Il permet de ne publier le contrat qu’en cas de litige, et même dans ce cas, de ne publier que les conditions exécutées. Les scripts utilisés dans Taproot utilisent un langage de programmation nommé Tapscript (BIP-342), basé sur le langage de script classique de Bitcoin.</p>
<p>Taproot repose sur un arbre de hachage, appelé un MAST<a href="#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a>, dont les feuilles sont les clauses du contrat, c’est-à-dire les conditions de dépense. Lors de l’exécution du MAST, les participants concernés ont seulement besoin de révéler la clause appliquée et de fournir les empreintes liées aux autres clauses (chemin de Merkle), comme montré sur la figure&nbsp;<a href="#fig:taproot-mast" data-reference-type="ref" data-reference="fig:taproot-mast">13.9</a>. Les autres conditions de dépense ne sont ainsi pas révélées.</p>
<div class="no-row-height column-margin column-container"><div id="fn26"><p><sup>26</sup>&nbsp;L’acronyme MAST signifie originellement <em>Merklized Abstract Syntax Trees</em>, ou «&nbsp;arbre syntaxique abstrait merkélisé&nbsp;» en français, et se réfère aux structures de données décrites par le BIP-114. Dans Taproot, ce ne sont pas vraiment des arbres syntaxiques abstraits qui interviennent, mais le terme reste utilisé. Les arbres de hachage de Taproot peuvent dans ce cas être appelés des <em>Merklized Alternative Script Trees</em>, par rétroacronymie. Voir Anthony Towns, <em>[bitcoin-dev] Safer sighashes and more granular SIGHASH_NOINPUT</em>, 23/11/2018 05:03:30 UTC&nbsp;: <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-November/016500.html" class="uri">https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-November/016500.html</a>.</p></div></div><div id="fig:taproot-mast" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/taproot-mast.png" class="img-fluid figure-img"></p>
<figcaption>MAST impliquant les clauses d’un contrat.</figcaption>
</figure>
</div>
<p>L’implémentation de tels MAST au sein de Bitcoin avait déjà été proposée par le passé, que ce soit sous la forme d’une nouvelle version de SegWit (BIP-114), ou bien d’un nouveau code opération appelé OP_MERKLEBRANCHVERIFY (BIP-116, BIP-117). Mais Taproot a constitué une proposition supérieure en permettant de ne pas révéler l’existence du MAST lui-même.</p>
<p>Taproot inclut en effet une condition de dépense coopérative intégrée. La clé publique agrégée interne est modifiée légèrement (<em>tweaked</em>) à l’aide de la racine du MAST, afin de prendre ce dernier en compte. La clé obtenue est celle inscrite dans le script de verrouillage de la pièce, de sorte qu’elle est indiscernable des autres sorties P2TR. De même, la signature agrégée ne peut pas être distinguée d’une signature classique. De ce fait, les participants peuvent dépenser les fonds à l’amiable, tout en étant sûrs qu’un litige mènera au règlement sur la chaîne.</p>
<p>Une alternative à Taproot est RGB, qui est un système de contrats autonomes hors chaîne, construit à la fois en surcouche de Bitcoin et de Lightning. Le nom est issu du standard RGB (<em>Red Green Blue</em>) qui permet de définir une couleur et constitue par conséquent une référence directe aux <em>colored coins</em>, RGB ayant été originellement conçu comme «&nbsp;une meilleure version des pièces colorées<a href="#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a>&nbsp;». Cependant, même si RGB permet effectivement d’émettre et de gérer des jetons, cette fonctionnalité est loin d’être la seule.</p>
<div class="no-row-height column-margin column-container"><div id="fn27"><p><sup>27</sup>&nbsp;RGB FAQ, <em>What does ‘RGB’ stand for?</em>, 14 décembre 2020&nbsp;: <a href="https://www.rgbfaq.com/faq/what-does-rgb-stand-for" class="uri">https://www.rgbfaq.com/faq/what-does-rgb-stand-for</a>.</p></div></div><p>RGB se base sur deux primitives techniques conceptualisées en 2016 par le développeur Peter Todd&nbsp;: la validation côté client (<em>client-side validation</em>) et les scellés à usage unique (<em>single-use seals</em>). Cela permet la gestion d’un état indépendant, où la double dépense est empêchée par ces scellés. Après avoir fait l’objet de recherches par Giacomo Zucco et le BHB Network, RGB est actuellement développé par la LNP/BP Standards Association.</p>
<p>L’implémentation de contrats en dehors de la chaîne est donc possible sur Bitcoin, et ils apportent deux choses. D’une part, ils réduisent le paiement de frais en ayant une empreinte minimale sur la chaîne. D’autre part, ils améliorent la confidentialité de leurs participants. C’est pourquoi ils ont le potentiel de jouer un grand rôle à long terme.</p>
</section>
<section id="une-monnaie-programmable" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="une-monnaie-programmable">Une monnaie programmable</h2>
<p>L’aspect programmable de Bitcoin est souvent négligé. Il n’est en effet pas directement présenté dans le livre blanc, même si Satoshi Nakamoto l’avait déjà élaboré à ce moment-là. Il est toutefois très utile et constitue l’une des facettes essentielles de Bitcoin.</p>
<p>La programmabilité de la monnaie peut servir à contrôler, comme l’illustrent les projets de MNBC qui fleurissent autour du monde. Mais elle peut également rendre un fier service à la liberté individuelle. En effet, cet aspect modulable donne l’occasion à des personnes qui ne se connaissent pas d’échanger de la valeur de la façon la plus sûre possible ou, comme l’exprimait Tim May dans son <em>Manifeste crypto anarchiste</em> de 1988, de «&nbsp;faire des affaires et négocier des contrats électroniques sans jamais connaître le Vrai Nom, ou l’identité légale, de l’autre<a href="#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a>&nbsp;».</p>
<div class="no-row-height column-margin column-container"><div id="fn28"><p><sup>28</sup>&nbsp;Timothy C. May, <em>The Crypto Anarchist Manifesto</em>, 22/11/1992 20:11:24 UTC&nbsp;: <a href="https://cypherpunks.venona.com/date/1992/11/msg00204.html" class="uri">https://cypherpunks.venona.com/date/1992/11/msg00204.html</a>.</p></div></div><p>Les contrats autonomes forment la pierre angulaire des relations financières dans le cyberespace. Même la communauté de Monero, qui avait particulièrement restreint cet aspect à des fins de confidentialité, est revenue sur ses pas en intégrant au protocole la fonctionnalité de signature multipartite, notamment dans le but de permettre les échanges atomiques. Une monnaie réellement libre se doit de pouvoir être programmée librement.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/les-rouages-de-la-machine.html" class="pagination-link" aria-label="Les rouages de la machine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Les rouages de la machine</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/le-passage-a-l-echelle.html" class="pagination-link" aria-label="Le passage à l'échelle">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Le passage à l’échelle</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2024 Konsensus Network
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../index.html">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../presale.html">
<p>Acheter</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/konsensusn">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/konsensusnetwork">
      <i class="bi bi-github" role="img" aria-label="Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/konsensusnetwork">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/konsensusnetwork">
      <i class="bi bi-youtube" role="img" aria-label="YouTube">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>