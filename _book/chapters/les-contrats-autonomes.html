<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Autonomous Contracts – L'Élégance de Bitcoin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/le-passage-a-l-echelle.html" rel="next">
<link href="../chapters/les-rouages-de-la-machine.html" rel="prev">
<link href="..//figures/freestarfish.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="13&nbsp; Autonomous Contracts – L’Élégance de Bitcoin">
<meta property="og:description" content="">
<meta property="og:image" content="cover.png">
<meta property="og:site_name" content="L'Élégance de Bitcoin">
<meta name="twitter:title" content="13&nbsp; Autonomous Contracts – L’Élégance de Bitcoin">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="cover.png">
<meta name="twitter:site" content="@konsensusn">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">L’Élégance de Bitcoin</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-book" role="img" aria-label="Book">
</i> 
<span class="menu-text">Lire en ligne</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bitcoinbook.shop/products/lelegance-de-bitcoin"> <i class="bi bi-shop" role="img" aria-label="Shop">
</i> 
<span class="menu-text">Acheter ce livre!</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/les-contrats-autonomes.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Autonomous Contracts</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main">
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos de ce livre</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface-de-jacques-favier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface by Jacques Favier</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/remerciements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/avant-propos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-debuts-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Beginnings of Bitcoin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/une-croissance-conflictuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A Conflict-Ridden Growth</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/des-racines-monetaires.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Monetary Roots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-necessite-de-decentralisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Necessity of Decentralization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/un-mouvement-technologique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Un mouvement technologique</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-cybermonnaie-avant-nakamoto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cryptocurrency Before Nakamoto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-valeur-de-l-information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Value of Information</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-consensus-par-le-minage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Consensus Through Mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-resistance-a-la-censure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Resistance to Censorship</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-changement-de-la-monnaie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Evolution of Currency</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/la-determination-du-protocole.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Determining the Protocol</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-rouages-de-la-machine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Inner Workings of the Machine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/les-contrats-autonomes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Autonomous Contracts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/le-passage-a-l-echelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling Up</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/l-avenir-de-bitcoin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The Future of Bitcoin</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simple-contracts" id="toc-simple-contracts" class="nav-link active" data-scroll-target="#simple-contracts">Simple Contracts</a>
  <ul class="collapse">
  <li><a href="#the-multisignature-account" id="toc-the-multisignature-account" class="nav-link" data-scroll-target="#the-multisignature-account">The Multisignature Account</a></li>
  <li><a href="#escrow-arrangements" id="toc-escrow-arrangements" class="nav-link" data-scroll-target="#escrow-arrangements">Escrow Arrangements</a></li>
  <li><a href="#crowdfunding" id="toc-crowdfunding" class="nav-link" data-scroll-target="#crowdfunding">Crowdfunding</a></li>
  <li><a href="#atomic-swaps" id="toc-atomic-swaps" class="nav-link" data-scroll-target="#atomic-swaps">Atomic Swaps</a></li>
  </ul></li>
  <li><a href="#payment-channels" id="toc-payment-channels" class="nav-link" data-scroll-target="#payment-channels">Payment Channels</a>
  <ul class="collapse">
  <li><a href="#poon-dryja-payment-channels" id="toc-poon-dryja-payment-channels" class="nav-link" data-scroll-target="#poon-dryja-payment-channels">Poon-Dryja Payment Channels</a></li>
  <li><a href="#decker-russell-osuntokun-payment-channels" id="toc-decker-russell-osuntokun-payment-channels" class="nav-link" data-scroll-target="#decker-russell-osuntokun-payment-channels">Decker-Russell-Osuntokun Payment Channels</a></li>
  </ul></li>
  <li><a href="#inscription-of-arbitrary-data" id="toc-inscription-of-arbitrary-data" class="nav-link" data-scroll-target="#inscription-of-arbitrary-data">Inscription of Arbitrary Data</a></li>
  <li><a href="#metaprotocols" id="toc-metaprotocols" class="nav-link" data-scroll-target="#metaprotocols">Metaprotocols</a></li>
  <li><a href="#off-chain-contracts" id="toc-off-chain-contracts" class="nav-link" data-scroll-target="#off-chain-contracts">Off-Chain Contracts</a></li>
  <li><a href="#a-programmable-currency" id="toc-a-programmable-currency" class="nav-link" data-scroll-target="#a-programmable-currency">A Programmable Currency</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="ch:contracts" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Autonomous Contracts</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A self-executing contract, known in English as a <em>smart contract</em>, is a computer program that operates without the need for a trusted third party. These contracts are also referred to as self-executable contracts or, literally translated, intelligent contracts. Each contract consists of clauses that specify particular spending conditions.</p>
<p>Bitcoin represents the first practical implementation of a system hosting autonomous contracts through its internal programming mechanism that employs scripts within transactions. This enables the execution of a variety of contracts, ranging from multisignature accounts to payment channels and escrow arrangements. The openness provided by this capability facilitates the inscription of arbitrary data on the chain, a strictly non-monetary use case of the protocol.</p>
<section id="simple-contracts" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="simple-contracts">Simple Contracts</h2>
<p>The concept of autonomous contracts<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> emerged within the cypherpunk movement in the 1990s. It was introduced by Nick Szabo in 1994, who defined it as follows:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;The term “contrat autonome” aiming to translate <em>smart contract</em> was proposed by Jacques Favier, Adli Takkal-Bataille, and Benoît Huguet in <em>Bitcoin: Métamorphoses</em> (pp.&nbsp;105–107) in 2018.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Nick Szabo, <em>Smart Contracts</em>, 1994, archived: <a href="https://web.archive.org/web/20011102030833/http://szabo.best.vwh.net:80/smart.contracts.html" class="uri">https://web.archive.org/web/20011102030833/http://szabo.best.vwh.net:80/smart.contracts.html</a>.</p></div></div><p>“A smart contract is a computerized transaction protocol that executes the terms of a contract. The general objectives of designing smart contracts are to satisfy common contractual conditions (such as payment terms, liens, confidentiality, and even enforcement), minimize exceptions both malicious and accidental, and minimize the need for trusted intermediaries<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.”</p>
<p>The simplest form of an autonomous contract is value transfer, containing only one clause: the provision of a digital signature corresponding to a given public key. However, a multitude of other contracts can be implemented on Bitcoin, making it impossible to provide an exhaustive list. Here, we will describe a few examples to explain how they can be implemented. Let’s first examine specific cases such as the multisignature account, escrow arrangements, crowdfunding, and atomic swaps.</p>
<section id="the-multisignature-account" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="the-multisignature-account">The Multisignature Account</h3>
<p>A multisignature account is a shared account between multiple entities. It is based on the multipartite signature scheme described in Chapter&nbsp;<a href="#ch:mechanics" data-reference-type="ref" data-reference="ch:mechanics">12</a>, where spending funds requires M signatures out of N participants (known as “M-of-N”). For example, spending from a 2-of-3 account requires that 2 out of 3 predetermined participants provide a valid signature, regardless of which individuals they are.</p>
<p>This type of contract is useful for joint accounts between spouses (2-of-2), facilitating corporate holdings (e.g., 3 partners out of 7), or improving the general security of bitcoin storage. Exchanges notably use this type of contract to manage their assets. As of November 2023, the world’s second-richest address was Bitfinex’s 3-of-5 multisignature address, holding over 178,000&nbsp;BTC<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Bitfinex’s 3-of-5 multisignature address is bc1qgdjqv0av3q56jvd82tkdjpy7gdp9ut8tlqmgrpmv24sq90ecnvqqjwvw97.</p></div></div></section>
<section id="escrow-arrangements" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="escrow-arrangements">Escrow Arrangements</h3>
<p>An escrow, known in English as <em>escrow</em>, is a method that involves a trusted third party, such as a notary, to secure a transaction between two parties who are wary of each other. Utilizing Bitcoin’s programmability can reduce the third party’s power by including a limitation in the clause concerning them. This type of contract relies on two basic technical components: multisignature schemes and timelocks.</p>
<p>Consider the example of two individuals who do not know each other, Alice and Bob, wanting to conduct an online transaction: Alice is the buyer, and Bob is the seller. They both engage a trusted intermediary, Lenny, to create the escrow contract. Alice sends funds to it and waits to receive the goods. Two clauses can then be activated:</p>
<ul>
<li><p><strong>Amicable settlement</strong>: The contract is unlocked by the signatures of both parties, who can choose to send the funds to Bob (successful exchange) or refund Alice (failed exchange).</p></li>
<li><p><strong>Dispute resolution</strong>: After a predetermined period (e.g., 30 days), the contract can be unlocked by Lenny’s signature and that of one of the two parties; in this case, Lenny determines who is the honest party and sends the funds accordingly.</p></li>
</ul>
<div id="fig:escrow-contract" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/escrow-contract.png" class="img-fluid figure-img"></p>
<figcaption>Escrow contract.</figcaption>
</figure>
</div>
<p>As depicted in Figure&nbsp;<a href="#fig:escrow-contract" data-reference-type="ref" data-reference="fig:escrow-contract">13.1</a>, this mechanism encourages both parties to cooperate to avoid delays and prevents the third party (Lenny) from colluding with either party before the stipulated period (30 days here). Thus, reliance on trust is minimized as much as possible.</p>
<p>This type of contract was endorsed by Satoshi Nakamoto in the white paper<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Indeed, the irreversibility of transfers in Bitcoin offered little guarantee for merchants, and escrow arrangements helped mitigate the problem. This mechanism is typically involved today in peer-to-peer exchange platforms like Bisq or Hodl Hodl, even if the implementation differs from what’s presented here.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;“Buyers could be easily protected by routine escrow mechanisms.”—Satoshi Nakamoto, <em>Bitcoin: A Peer-to-Peer Electronic Cash System</em>, October 31, 2008.</p></div></div></section>
<section id="crowdfunding" class="level3">
<h3 class="anchored" data-anchor-id="crowdfunding">Crowdfunding</h3>
<p>Crowdfunding involves reaching out to the general public to contribute to the support of a project, as opposed to financing through bank loans or raising funds from professional venture capitalists. It is most often an informal agreement between the project’s promoter and the public, aimed at supporting the creation of a common good that benefits everyone. In Bitcoin, this agreement can be executed through revocable payment promises that are not subject to the arbitrariness of a trusted third party.</p>
<p>Technically, this involves creating a transaction called “anyone-can-pay,” where each contributor’s signature covers only the funding output and their own input, allowing additional inputs to be added (see Figure&nbsp;<a href="#fig:sighash-anyonecanpay" data-reference-type="ref" data-reference="fig:sighash-anyonecanpay">13.2</a>). The resulting transaction is valid only if the total inputs reach the specified output amount, so contributors retain control of their funds until the total payment is made and can withdraw at any time.</p>
<div id="fig:sighash-anyonecanpay" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/sighash-anyonecanpay.png" class="img-fluid figure-img"></p>
<figcaption>Crowdfunding transaction.</figcaption>
</figure>
</div>
<p>In the world of open-source software, this type of crowdfunding is particularly important because there’s no privilege associated with writing code that allows one to make a living by selling licenses. This is even more true in the world of cryptocurrency, which heavily depends on the proper maintenance of software implementations. This is why Mike Hearn, who was closely interested in Bitcoin’s programming capabilities, quickly adopted this possibility to deploy such “assurance contracts” allowing for community funding of ecosystem projects. He implemented the concept in his Lighthouse application, a functional version of which was released in 2015, aiming to facilitate community support for projects. With the onset of the block size war, this project was set aside by Hearn and eventually abandoned. However, the method was later adopted on Bitcoin Cash in 2020 via Flipstarter, which helped raise significant sums to fund the protocol’s software infrastructure.</p>
</section>
<section id="atomic-swaps" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="atomic-swaps">Atomic Swaps</h3>
<p>An atomic swap is a secure way to exchange two cryptocurrencies operating on different blockchains without using a trusted intermediary. The term “atomic” refers to the indivisible nature (from the ancient Greek <span lang="el">ἄτομος</span>, <em>átomos</em>) of the exchange: either both parties transfer their due amounts, or nothing happens. The concept was described by Sergio Lerner and Gregory Maxwell in July 2012 on the Bitcointalk forum<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Sergio Demian Lerner, <em>P2PTradeX: P2P Trading between cryptocurrencies</em>, July 5, 2012, 23:49:48 UTC: <a href="https://bitcointalk.org/index.php?topic=91843.msg1011737#msg1011737" class="uri">https://bitcointalk.org/index.php?topic=91843.msg1011737#msg1011737</a>; Gregory Maxwell, <em>Re: P2PTradeX: P2P Trading between cryptocurrencies</em>, July 6, 2012, 02:17:02 UTC: <a href="https://bitcointalk.org/index.php?topic=91843.msg1011956#msg1011956" class="uri">https://bitcointalk.org/index.php?topic=91843.msg1011956#msg1011956</a>.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;To ensure the proper execution of the contract (avoid transaction replacement during confirmation wait), public keys are assigned to each of these conditions so that a signature is always required from the recipient of the funds.</p></div></div><p>The atomic swap relies on the concept of a hash time-locked contract (HTLC), which is a contract with two clauses, meaning the funds can be unlocked under two conditions<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>:</p>
<ul>
<li><p><strong>Mutual agreement</strong>: The revelation of a secret that is hashed by a function and compared to the hash embedded in the contract.</p></li>
<li><p><strong>Dispute resolution</strong>: Waiting for a certain predetermined lock time specified in the contract.</p></li>
</ul>
<p>Consider an example of an atomic swap between Alice, who has BTC, and Bob, who has LTC. Alice (<em>maker</em>) proposes to exchange 0.03 BTC for 10&nbsp;LTC, at an exchange rate of 0.003&nbsp;LTC per BTC, and Bob (<em>taker</em>) accepts the deal. This negotiation can occur via a public or private order book. Alice randomly chooses a secret (denoted <span class="math inline">\(s\)</span>), a 32-byte number, whose cryptographic hash <span class="math inline">\(H(s)\)</span> she provides to Bob. They can thus each build a contract on their side to perform the atomic swap. The process is described in Figure&nbsp;<a href="#fig:atomic-swap-contract" data-reference-type="ref" data-reference="fig:atomic-swap-contract">13.3</a>.</p>
<p>The first phase is the commitment phase. First, Alice constructs, signs, and broadcasts a commitment transaction sending 0.03&nbsp;BTC to the atomic swap contract on the Bitcoin chain. She provides its content and address to Bob for verification. Then, she constructs and signs a refund transaction spending the funds from this contract, which she can broadcast after a predefined delay (here, 16 hours). Once Alice’s commitment transaction is confirmed, Bob does the same on his side: he creates an equivalent contract on the Litecoin chain, where he sends 10&nbsp;LTC, and gives its content and address to Alice for her to ensure everything is in order. Finally, he constructs and signs a transaction that will refund him after a delay strictly less than Alice’s transaction (here, 8 hours). This difference results from the unbalanced relationship between Alice (who knows the unlocking secret) and Bob (who does not).</p>
<p>Once the commitment transactions are confirmed on their respective chains, the second phase of the atomic swap—the collection phase—can begin. Alice constructs, signs, and broadcasts a transaction that allows her to retrieve Bob’s 10&nbsp;LTC. To do this, she provides the secret within the transaction, thereby revealing it to Bob. Finally, Bob can also construct, sign, and broadcast a transaction that grants him the 0.03&nbsp;BTC to his account. In this way, the exchange is completed!</p>
<div id="fig:atomic-swap-contract" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/atomic-swap-contract.png" class="img-fluid figure-img"></p>
<figcaption>Contracts and transactions in an atomic swap.</figcaption>
</figure>
</div>
<p>This model ensures that neither participant can refund themselves before the end of Bob’s lock time (8 hours); that Alice cannot assert her refund transaction at the time of broadcasting her collection transaction; and that Bob cannot appropriate Alice’s funds until she has broadcast her transaction. These guarantees make the process logically secure, even if disruptive events can occur, such as increased confirmation times due to fee market volatility.</p>
<p>The first real atomic swap was conducted between Litecoin and Decred on September 19, 2017, by Charlie Lee and Alex Yocom-Piatt<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Today, atomic swaps are rare, and the order books of specialized platforms like AtomicDEX are sparsely populated. However, with the tightening regulations affecting the ecosystem and making centralized platforms less reliable, it’s possible they will play a major role in the future.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;The contract addresses on LTC and DCR were (respectively) MLp49daA411aoZ1TmGEdyLuTCE9YA6xhpc and DccPF1yt9cV8vhr97fq3umBx7RqV53MYGDY. The exchange was 1.337&nbsp;LTC for 2.4066&nbsp;DCR.—<em>Decred-compatible cross-chain atomic swapping</em>, September 20, 2017: <a href="https://github.com/decred/atomicswap/blob/master/README.md#first-mainnet-dcr-ltc-atomic-swap" class="uri">https://github.com/decred/atomicswap/blob/master/README.md#first-mainnet-dcr-ltc-atomic-swap</a>.</p></div></div></section>
</section>
<section id="payment-channels" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="payment-channels">Payment Channels</h2>
<p>A particular application of autonomous contracts in Bitcoin is the deployment of payment channels. A payment channel allows two users to make repeated bitcoin payments securely and instantly without publishing transactions on the blockchain, using previously locked funds. These channels are fundamental to the Lightning Network, built as a layer on top of the chain.</p>
<section id="poon-dryja-payment-channels" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="poon-dryja-payment-channels">Poon-Dryja Payment Channels</h3>
<p>Although the idea of a payment channel was envisioned from the early days, it only materialized with the concept developed by Joseph Poon and Thaddeus Dryja in their Lightning Network project<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>. This concept involves a bidirectional channel whose security relies on a penalty mechanism. Both participants lock funds in a 2-of-2 multisignature contract and can make payments to each other within the available liquidity. The sum of both participants’ balances is referred to as the channel capacity.</p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Joseph Poon and Thaddeus Dryja, <em>The Bitcoin Lightning Network DRAFT Version 0.5</em>, February 28, 2015: <a href="https://lightning.network/lightning-network-paper-DRAFT-0.5.pdf" class="uri">https://lightning.network/lightning-network-paper-DRAFT-0.5.pdf</a>.</p></div></div><p>A channel goes through three phases during its existence:</p>
<ul>
<li><p><strong>Opening or setup phase</strong>: Funds are locked by the participants into an autonomous 2-of-2 multisignature contract.</p></li>
<li><p><strong>Negotiation or update phase</strong>: The distribution of funds within the channel is adjusted.</p></li>
<li><p><strong>Closing or settlement phase</strong>: Funds are distributed to the participants on-chain, usually cooperatively according to the latest state of the channel.</p></li>
</ul>
<p>The initial distribution and channel updates are carried out through commitment transactions exchanged between the participants and <em>not broadcasted</em> to the network unless a dispute occurs, such as a non-cooperative closure. These commitment transactions are asymmetric, meaning each participant has their own version.</p>
<p>Suppose Alice and Bob have a channel, as illustrated in Figure&nbsp;<a href="#fig:poon-dryja-contracts" data-reference-type="ref" data-reference="fig:poon-dryja-contracts">13.4</a>. In this case, Alice’s latest commitment transaction, which can only be finalized and broadcasted by Bob, accounts for the updated state of the channel and distributes the funds between Alice’s address and a claim contract. This claim contract contains two clauses:</p>
<ul>
<li><p><strong>Recovery by Bob</strong>: After a locktime, Bob can recover the funds, distributing them according to the balances indicated in the channel.</p></li>
<li><p><strong>Recovery by Alice</strong>: Using a revocation key that is revealed later when the channel is updated again, Alice can recover the funds.</p></li>
</ul>
<p>If a payment occurs from Alice to Bob, the channel update proceeds as follows. Alice constructs and signs her commitment transaction using Bob’s revocation public key, which he previously provided to her. Only Bob can finalize and broadcast this transaction. Bob responds by sending her his revocation private key, rendering Alice’s previous commitment transaction ineffective. The same process occurs symmetrically: Bob constructs and signs his commitment transaction, sends it to Alice, and she reveals her revocation private key in exchange, making Bob’s prior commitment transaction powerless<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;Andreas M. Antonopoulos, Olaoluwa Osuntokun, René Pickhardt, “Payment Channels,” in <em>Mastering the Lightning Network: A Second Layer Blockchain Protocol for Instant Bitcoin Payments</em>, O’Reilly Media, 2022, pp.&nbsp;149–184.</p></div></div><p>Revealing the revocation key at each update stage enables a penalty mechanism at any time. If one of the parties broadcasts a commitment transaction corresponding to a previous state of the channel, the other can recover <em>all</em> the funds in the channel. For example, Alice could recover Bob’s funds if he were to broadcast a previous channel state intending to “undo” the last payment.</p>
<div id="fig:poon-dryja-contracts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/lightning-poon-dryja-channel-contracts.png" class="img-fluid figure-img"></p>
<figcaption>Contracts and transactions in a Poon-Dryja payment channel: case of Bob paying 2&nbsp;mBTC to Alice.</figcaption>
</figure>
</div>
<p>The main drawback of this penalty mechanism is that continuous network monitoring is required to prevent theft, necessitating a full node or a well-chosen trusted third party (a “watchtower”).</p>
<p>This functioning of Poon-Dryja channels also means that any error is heavily penalized: accidentally broadcasting a prior commitment transaction leads to the other party recovering the funds. It has other drawbacks as well: it requires storing all previous channel states, forces participants to choose transaction fees in advance, and significantly complicates innovations within the Lightning Network. To improve this situation, the “Decker-Russell-Osuntokun” payment channels were conceptualized.</p>
</section>
<section id="decker-russell-osuntokun-payment-channels" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="decker-russell-osuntokun-payment-channels">Decker-Russell-Osuntokun Payment Channels</h3>
<p>The Decker-Russell-Osuntokun payment channels were described by Christian Decker, Rusty Russell, and Olaoluwa Osuntokun in a white paper published in April 2018<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. The underlying protocol is called Eltoo, a play on “L2” (signifying <em>layer two</em>).</p>
<div class="no-row-height column-margin column-container"><div id="fn10"><p><sup>10</sup>&nbsp;Christian Decker, Rusty Russell, Olaoluwa Osuntokun, <em>eltoo: A Simple Layer2 Protocol for Bitcoin</em>, April 30, 2018: <a href="https://blockstream.com/eltoo.pdf" class="uri">https://blockstream.com/eltoo.pdf</a>.</p></div></div><p>The functioning of Decker-Russell-Osuntokun channels is based on a chain of transactions that are not intended to be broadcast on-chain, except for the opening and closing transactions (see Figure&nbsp;<a href="#fig:eltoo" data-reference-type="ref" data-reference="fig:eltoo">13.5</a>). The principle is as follows:</p>
<ul>
<li><p><strong>Channel opening</strong>: An opening transaction (<span class="math inline">\(T_{u,0}\)</span>), previously backed by a settlement transaction (<span class="math inline">\(T_{s,0}\)</span>) that reimburses the participants in case of a dispute.</p></li>
<li><p><strong>Channel update</strong>: Update transactions (<span class="math inline">\(T_{u,i}\)</span>) that invalidate previous settlement transactions (<span class="math inline">\(T_{s,i-1}\)</span>).</p></li>
<li><p><strong>Channel closing</strong>: The channel can be closed after a certain expiration delay by broadcasting the latest settlement transaction (<span class="math inline">\(T_{s,i}\)</span>).</p></li>
</ul>
<p>In this model, there’s no need to use revocation keys to render previous channel states unusable; the transactions themselves serve this role. Eltoo involves what’s called floating transactions, which can spend funds from any previous update transaction. This means each update transaction is floating, as is each settlement transaction, allowing omission of all previous updates. Additionally, a state number is included in each transaction to order them and prevent the broadcasting of an earlier state.</p>
<div id="fig:eltoo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/eltoo-offchain-protocol.png" class="img-fluid figure-img"></p>
<figcaption>Overview of the Eltoo protocol.</figcaption>
</figure>
</div>
<p>An additional transaction is added to the chain to prevent the expiration delay of settlement transactions <span class="math inline">\(T_{s,i}\)</span> from being reached and them being broadcast on-chain. This transaction simply sends the funds to a regular multisignature account and is signed and broadcast after the signing of the initial update and settlement transactions (<span class="math inline">\(T_{u,0}\)</span> and <span class="math inline">\(T_{s,0}\)</span>). The expiration delay only begins when transaction <span class="math inline">\(T_{u,0}\)</span> is broadcast.</p>
<p>This mechanism allows for a simple protocol for updating the channel, less constraining for nodes, without a penalty mechanism, and without needing to decide fees in advance. This ease of implementation could facilitate the creation of more complex contracts on Lightning, such as payment channels with three or more participants. Moreover, their implementation does not need to replace that of Poon-Dryja channels; both models can coexist within a single network of payment channels.</p>
<p>Floating transactions are implemented using SIGHASH_ANYPREVOUT. Thus, the realization of Eltoo relies on the integration of BIP-118 into Bitcoin.</p>
</section>
</section>
<section id="inscription-of-arbitrary-data" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="inscription-of-arbitrary-data">Inscription of Arbitrary Data</h2>
<p>Bitcoin allows the inscription of non-financial data on the chain—that is, data not necessary for locking and unlocking funds and interpreted outside the protocol. Even with all possible restrictions, it’s impossible to prevent the inscription of such data, although it can be made more costly.</p>
<p>The main chain of Bitcoin is widely shared around the world and will be preserved by humanity, at least as a historical relic, suggesting that what is stored there will be kept for a very long time. This characteristic encourages people to include things that matter to them. It’s human nature to seek to leave traces of our passage on Earth, and writing on a supposedly immutable ledger is one way to do it.</p>
<p>Various methods of inscription exist, each with its own qualities and drawbacks. These have evolved over the years as this usage became more prevalent.</p>
<p>On one hand, arbitrary data can be written by miners within the coinbase transaction input, specifically in the unlocking script. This field is conceptually superfluous—the coinbase doesn’t refer to any existing output—and can thus be used at discretion. This is the method Satoshi Nakamoto used to inscribe the now-famous headline from the January 3, 2009, issue of <em>The Times</em> in the genesis block:</p>
<p><em>“The Times 03/Jan/2009 Chancellor on brink of second bailout for banks”</em></p>
<p>Other blocks contain notable messages. The exodus block of BCH (height 478,559) included a welcome message for Shuya Yang, the daughter of the CEO of the ViaBTC mining pool. The block preceding the third halving on BTC in 2020 (height 629,999) included the headline from a <em>New York Times</em> article dated April 9 announcing the Federal Reserve’s record liquidity injection of $2.3 trillion in response to the COVID-19 crisis: “<em>NYTimes 09/Apr/2020 With $2.3T Injection, Fed’s Plan Far Exceeds 2008 Rescue</em>.”</p>
<p>The coinbase unlocking script can be used to write other data as well. This includes the extra nonce (the criterion that helped identify Satoshi’s bitcoins). It’s also how mining pools signal themselves through this field; for example, the coinbase of block 751,005 contains the string <em>poolin.com</em>, indicating that it was likely validated by the Chinese pool Poolin.</p>
<p>On the other hand, users can include arbitrary data within their transactions and pay the corresponding fees. Several methods have been used for this.</p>
<p>Before 2014, these inscriptions were most often made by storing data in locking scripts, for example, using the <code>OP_DROP</code> stack instruction<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. Another common practice was inscribing data in P2PKH-type outputs, which were then rendered unspendable. This method was extremely costly due to the transaction structure (requiring inscription in the outputs) and the need to send non-zero amounts in outputs. It was also detrimental to the system as a whole because it bloated the entire UTXO set.</p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;Transaction c0b2cf75b47d1e7f48cdb4287109ff1dd5bcf146d5f77a9e8784c0c9c0ef02ad, confirmed on December 13, 2012, contains the string <em>TheCakeIsALie\n</em> in reference to the video game <em>Portal</em>.</p></div><div id="fn12"><p><sup>12</sup>&nbsp;Bitcoin Core, <em>Bitcoin Core version 0.9.0 released</em>, March 19, 2014: <a href="https://bitcoin.org/en/release/v0.9.0#opreturn-and-data-in-the-block-chain" class="uri">https://bitcoin.org/en/release/v0.9.0#opreturn-and-data-in-the-block-chain</a>.</p></div></div><p>After 2014, a more efficient way to store data was authorized through the standardization of the NULLDATA scheme based on the <code>OP_RETURN</code> instruction. This change allowed for the creation of “provably prunable outputs, to avoid data storage schemes […] that were storing arbitrary data, such as images, as forever unspendable transaction outputs, thereby bloating Bitcoin’s UTXO database<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>.” It also limited the wastage of funds by allowing the creation of a 0-satoshi output. This scheme quickly became the most popular way to publish information on the chain.</p>
<p>Furthermore, it’s possible to store data within transaction inputs or associated witnesses when spending P2SH, P2WSH, or P2TR outputs. This writing can occur in the redeem scripts or in the unlocking elements. This method has the advantage of not overloading the entire UTXO set. For users, for inputs where SegWit applies, it has the benefit of reducing the cost of arbitrary data inscribed in the transaction by four.</p>
<p>These different methods have been used to inscribe various items on the chain, including cryptographic hashes, text, and images<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn13"><p><sup>13</sup>&nbsp;Ken Shirriff, <em>Hidden surprises in the Bitcoin blockchain and how they are stored: Nelson Mandela, Wikileaks, photos, and Python software</em>, February 16, 2014: <a href="https://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html" class="uri">https://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html</a>.</p></div><div id="fn14"><p><sup>14</sup>&nbsp;Hal Finney, <em>Re: [bitcoin-list] Bitcoin v0.1.5 released</em>, February 27, 2009, 20:00:12 UTC, archived: <a href="https://web.archive.org/web/20131016004925/http://sourceforge.net/p/bitcoin/mailman/bitcoin-list/?viewmonth=200902" class="uri">https://web.archive.org/web/20131016004925/http://sourceforge.net/p/bitcoin/mailman/bitcoin-list/?viewmonth=200902</a>.</p></div></div><p>First, one can inscribe a hash, with the inscription serving as a timestamp. This involves inscribing the hash of a file on the chain as proof of existence. This idea was put forward in February 2009 by Hal Finney in an email to the Bitcoin mailing list. He suggested that “the Bitcoin block chain would be perfect” to “prove that a certain document existed at a certain time in the past<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>,” a view approved by Satoshi. In essence, this practice allows one to demonstrate knowledge of information before its publication and thus indirectly claim probable authorship. This type of use has notably been implemented by the French company Woleet.</p>
<p>This possibility can also be exploited by decentralized file hosting systems like IPFS (InterPlanetary File System), which uses file hashes to identify them and allows their storage by a peer-to-peer network of users. It’s thus possible to associate text written on the blockchain with images or videos hosted in a decentralized manner.</p>
<p>Next, one can inscribe text, usually encoded in ASCII/UTF-8. For example, the phrase “Beauty will save the world.” was inscribed on the BTC chain on August 10, 2022, in transaction 08e5ce0783ab6d5534e234136df02e0e240f76108eb6af04b8b624646b66f5eb. Inscribing texts also allows for drawing images in ASCII art. This is the case with the tribute to Len Sassaman (see Figure&nbsp;<a href="#fig:sassaman-tribute" data-reference-type="ref" data-reference="fig:sassaman-tribute">13.6</a>), who passed away in July 2011. It was inscribed on the chain by developers Dan Kaminsky and Travis Goodspeed in P2PKH outputs and notably contains a representation of former Fed Chairman Ben Bernanke.</p>
<figure id="fig:sassaman-tribute" class="figure">
<pre data-fontsize="\footnotesize"><code>---BEGIN TRIBUTE---  =-=-=-=-=-=-=-=-=-=     ASCII BERNANKE
            #./BitLen            LEN "rabbi" SASSAMA  :'::.:::::.:::.::.:
            :::::::::::::::::::       1980-2011       : :.: ' ' ' ' : :':
            :::::::.::.::.:.:::  Len was our friend.  :.:     _.__    '.:
            :.: :.' ' ' ' ' : :  A brilliant mind,    :   _,^"   "^x,   :
            :.:'' ,,xiW,"4x, ''  a kind soul, and     '  x7'        `4,
            :  ,dWWWXXXXi,4WX,   a devious schemer;    XX7            4XX
            ' dWWWXXX7"     `X,  husband to Meredith   XX              XX
             lWWWXX7   __   _ X  brother to Calvin,    Xl ,xxx,   ,xxx,XX
            :WWWXX7 ,xXX7' "^X  son to Jim and       ( ' _,+o, | ,o+,"
            lWWWX7, _.+,, _.+.,  Dana Hartshorn,       4   "-^' X "^-'" 7
            :WWW7,. `^"-" ,^-;   coauthor and          l,     ( ))     ,X
             WW",X:        X,    cofounder and         :Xx,_ ,xXXXxx,_,XX
             "7^^Xl.    _(_x7'   Shmoo and so much      4XXiX'-___-'XXXX'
             l ( :X:       __ _  more.  We dedicate      4XXi,_   _iXX7'
             `. " XX  ,xxWWWWX7  this silly hack to     , `4XXXXXXXXX^ _,
              )X- "" 4X" .___.   Len, who would have    Xx,  ""^^^XX7,xX
            ,W X     :Xi  _,,_   found it absolutely  W,"4WWx,_ _,XxWWX7'
            WW X      4XiyXWWXd  hilarious.           Xwi, "4WW7""4WW7',W
            "" ,,      4XWWWWXX  --Dan Kaminsky,      TXXWw, ^7 Xk 47 ,WH
            , R7X,       "^447^  Travis Goodspeed     :TXXXWw,_ "), ,wWT:
            R, "4RXk,      _, ,  P.S.  My apologies,  ::TTXXWWW lXl WWT:
            TWk  "4RXXi,   X',x  BitCoin people.  He  ----END TRIBUTE----
            lTWk,  "^"     `4   LOL'd at BitCoin's
            :lWWWk,  ^""     ''  new dependency upon</code></pre>
<figcaption>
Tribute to Len Sassaman (ASCII art).
</figcaption>
</figure>
<p>Finally, one can include an image, which can be encoded in multiple formats, notably JPEG or PNG. For example, a Bitcoin logo inscribed on May 13, 2011, can be found. A tribute to Nelson Mandela along with a photo was published on December 7, 2013, a few days after his death. In 2022, the lack of standard restrictions on Taproot script size allowed for voluminous inscriptions in a much more transparent and direct way. This notably enabled the inscription of the Taproot Wizards image, which was nearly 4&nbsp;MB in size (see Figure&nbsp;<a href="#fig:taproot-wizards" data-reference-type="ref" data-reference="fig:taproot-wizards">13.7</a>).</p>
<div id="fig:taproot-wizards" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/taproot-wizards-small-0301e0480b374b32851a9462db29dc19fe830a7f7d7a88b81612b9d42099c0aei0.jpg" class="img-fluid figure-img"></p>
<figcaption>Image (reduced) of the Taproot Wizards.</figcaption>
</figure>
</div>
<p>In general, any file format can be stored on the chain through multiple transactions: a document, a book, a video, a game, etc. However, this use is not always appropriate. Inscription requires paying fees, sometimes high, and the BTC blockchain isn’t really designed to store large amounts of data. Publishing these files on IPFS or on a local server is generally more suitable.</p>
<p>Note that the Bitcoin SV community focused on data storage, considering its ledger as a “universal source of truth<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.” Consequently, a significant volume of weather data, inscribed since 2019, can be found on its chain. This has made the BSV network extremely centralized in terms of both mining and commerce, which questions the primary utility of recording information on a blockchain: immutability.</p>
<div class="no-row-height column-margin column-container"><div id="fn15"><p><sup>15</sup>&nbsp;CoinGeek, <em>Jerry Chan: Bitcoin’s value is as a universal source of truth</em>, July 17, 2019: <a href="https://coingeek.com/jerry-chan-bitcoins-value-is-as-a-universal-source-of-truth-video/" class="uri">https://coingeek.com/jerry-chan-bitcoins-value-is-as-a-universal-source-of-truth-video/</a>.</p></div></div></section>
<section id="metaprotocols" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="metaprotocols">Metaprotocols</h2>
<p>Metaprotocols are protocols that leverage the base protocol to function. They utilize the inscription of arbitrary data on the chain to include instructions interpreted by specific software implementations. They are characterized by being more extensive than the base protocol.</p>
<p>This is not a novel idea. From Bitcoin’s early years, some individuals sought to exploit it more deeply, using it in ways beyond a simple value transfer instrument. This initial movement, aiming to add functionalities to Bitcoin in this manner, was termed “Bitcoin 2.0.” It eventually led to the development of Ethereum starting in 2013.</p>
<p>The first type of metaprotocol developed was the concept of <em>colored coins</em>, which involves marking coins (UTXOs) by the additional inscription of data, as illustrated in Figure&nbsp;<a href="#fig:colored-coin" data-reference-type="ref" data-reference="fig:colored-coin">13.8</a>. Each type of token created is linked to an identifier, which can be likened to a color, hence the name of this approach. The idea was presented in 2012 by Yoni Assia and Meni Rosenfeld<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn16"><p><sup>16</sup>&nbsp;Yoni Assia, <em>bitcoin 2.X (aka Colored Bitcoin) – initial specs</em>, March 27, 2012: <a href="https://yoniassia.com/coloredbitcoin/" class="uri">https://yoniassia.com/coloredbitcoin/</a>; Meni Rosenfeld, <em>Overview of Colored Coins</em>, December 4, 2012: <a href="https://bitcoil.co.il/BitcoinX.pdf" class="uri">https://bitcoil.co.il/BitcoinX.pdf</a>.</p></div></div><div id="fig:colored-coin" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/colored-coin.png" class="img-fluid figure-img"></p>
<figcaption>Creation and transfer of a token issued as a colored coin.</figcaption>
</figure>
</div>
<p>The implementation of this concept was carried out at the end of 2012 through the ChromaWallet. However, it only gained momentum from 2014, with the emergence of Coinprism’s Open Assets, Coin Sciences’ CoinSpark assets, and Colu’s Colored Coins. These uses have since fallen into disuse, although the procedure has been employed sporadically over the years, such as with Bisq’s BSQ token created in 2018 as the basis of its DAO. An attempt at revival was also made on Bitcoin Cash with SLP tokens, without significant success.</p>
<p>Beyond colored coins, more advanced protocols existed that managed their own unit of account. These were primarily Mastercoin, later renamed Omni in March 2015, and Counterparty.</p>
<p>The first advanced metaprotocol was Mastercoin, whose white paper, titled “<em>The Second Bitcoin Whitepaper</em>”, was published on January 6, 2012, by J.R. Willett<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>. It was a protocol allowing users to create their own currencies, called “user currencies.” Mastercoin was based on a unit of account noted as MSC, which was the subject of a one-month presale in July-August 2013<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>. It was the first Initial Coin Offering (ICO) in history, raising 5,120&nbsp;BTC, over $500,000 at that time.</p>
<div class="no-row-height column-margin column-container"><div id="fn17"><p><sup>17</sup>&nbsp;J.R. Willett, <em>The Second Bitcoin Whitepaper</em>, January 6, 2012, archived: <a href="https://cryptochainuni.com/wp-content/uploads/Mastercoin-2nd-Bitcoin-Whitepaper.pdf" class="uri">https://cryptochainuni.com/wp-content/uploads/Mastercoin-2nd-Bitcoin-Whitepaper.pdf</a>.</p></div><div id="fn18"><p><sup>18</sup>&nbsp;All bitcoins sent to address 1EXoDusjGwvnjZUyKkxZ4UHEf77z6A5S4P were converted into MSC at a rate of 100&nbsp;MSC at the beginning, decreasing over the weeks.</p></div></div><p>Perhaps the greatest success of this protocol was the creation of the first stablecoin, Tether USD, initially issued under the name Realcoin in October 2014. Mastercoin/Omni was long the only way to own and transfer USDT before the token was massively issued on other chains like Ethereum and Tron.</p>
<p>The second advanced metaprotocol was Counterparty, launched in January 2014. This platform also relied on a native token, XCP, which served as its fuel and was created by burning bitcoins during its first month of existence<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a>. Approximately 2,140 bitcoins were made unusable to give life to over 2.6 million XCP, still in circulation today. Counterparty aimed to be more flexible than Mastercoin by enabling the implementation of autonomous contracts, particularly to create tokens and host decentralized exchange platforms called “dispensers.”</p>
<div class="no-row-height column-margin column-container"><div id="fn19"><p><sup>19</sup>&nbsp;All bitcoins sent to address 1CounterpartyXXXXXXXXXXXXXXXUWLpVr between January 2 and February 3, 2014, were converted into XCP at a rate that varied between 1,000 and 1,500&nbsp;XCP per&nbsp;BTC.</p></div><div id="fn20"><p><sup>20</sup>&nbsp;Hal Finney, <em>Crypto trading cards.</em>, January 17, 1993, 18:48:02 UTC: <a href="https://cypherpunks.venona.com/date/1993/01/msg00152.html" class="uri">https://cypherpunks.venona.com/date/1993/01/msg00152.html</a>.</p></div></div><p>In particular, Counterparty was the first platform to offer the management of non-fungible tokens (NFTs). This implemented an old idea, notably highlighted by Hal Finney in 1993 on the cypherpunk mailing list as “cryptographic trading cards<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a>.” Counterparty hosted numerous such collections, like the <em>Spells of Genesis</em> and SaruTobi playing cards created in 2015, or the Rare Pepes issued between 2016 and 2018.</p>
<p>In 2018, the emergence of Bitcoin Cash motivated the creation of a social media platform whose data would be entirely stored on-chain, as BCH developers were more liberal in this regard. The protocol was called Memo and involved publishing short messages publicly visible under a defined profile, following other users, and liking and replying to their messages. The idea was to achieve a sort of censorship-resistant social network but suffered from the need to pay fees for each action.</p>
<p>All these protocols lost their appeal until the emergence of the Ordinals protocol, launched in January 2023. This metaprotocol allowed the creation and management of “digital artifacts,” i.e., NFTs whose full data is immutably stored on a censorship-resistant chain. Ordinals relied on an “ordinal theory” allowing for the tracking and transfer of satoshis linked to an inscription, such as text, images, or other data. In particular, Ordinals was used to emulate the ownership and transfer of fungible tokens, dubbed “BRC-20,” whose speculative success caused network congestion leading to historically high transaction fees. The success of Ordinals also inspired the creation of the STAMPS protocol, based on Counterparty for artifact tracking and storing their data in P2MS outputs.</p>
<p>All these practices sparked debates. Bitcoin was presented as a model of digital currency, and it seemed counterproductive to turn it into a data preservation protocol unrelated to bitcoin transfers. As early as December 2010, Jeff Garzik opposed using the chain for generalized storage<a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a>. Later, in 2014, similar disputes arose concerning Counterparty<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a>. In 2023, the same discord occurred following the success of Ordinals<a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn21"><p><sup>21</sup>&nbsp;Jeff Garzik, <em>Resist the urge to use block chain for generalized storage</em>, December 7, 2010, 22:04:54 UTC: <a href="https://bitcointalk.org/index.php?topic=2129.msg27884#msg27884" class="uri">https://bitcointalk.org/index.php?topic=2129.msg27884#msg27884</a>.</p></div><div id="fn22"><p><sup>22</sup>&nbsp;BitMEX Research, <em>The OP_Return Wars of 2014—Dapps Vs Bitcoin Transactions</em>, July 12, 2022: <a href="https://blog.bitmex.com/dapps-or-only-bitcoin-transactions-the-2014-debate/" class="uri">https://blog.bitmex.com/dapps-or-only-bitcoin-transactions-the-2014-debate/</a>.</p></div><div id="fn23"><p><sup>23</sup>&nbsp;pourteaux, <em>Illegitimate bitcoin transactions</em>, January 25, 2023: <a href="https://read.pourteaux.xyz/p/illegitimate-bitcoin-transactions" class="uri">https://read.pourteaux.xyz/p/illegitimate-bitcoin-transactions</a>.</p></div></div><p>These metaprotocols have two major flaws. The first is that verifying their rules depends on a small subset of network nodes. Indeed, managing such an overlay protocol requires additional resources, particularly for indexing in the case of colored coins. Consequently, few people deploy a complete implementation, significantly centralizing the protocol and making it susceptible to alteration by an adversary aiming to censor it.</p>
<p>The second flaw concerns their sometimes very high usage fees, especially if the network’s transactional capacity limit is reached. Transactions implementing these solutions are necessarily larger than normal transactions, leading to higher fees. They are therefore more easily excluded by the fee increases resulting from network congestion.</p>
<p>For these reasons, those who worked on these solutions quickly moved away from them, preferring to turn to alternative platforms like NXT and especially Ethereum. Vitalik Buterin himself was interested in colored coins and Mastercoin in 2013 before starting to build what would become Ethereum<a href="#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a>. It’s also for these reasons that less costly solutions—overlays using the chain as a settlement mechanism rather than as a place to record all operations—are now favored for such purposes, like RGB or Taproot Assets.</p>
<div class="no-row-height column-margin column-container"><div id="fn24"><p><sup>24</sup>&nbsp;Yoni Assia, Vitalik Buterin, Meni Rosenfeld, Rotem Lev, <em>Colored Coins whitepaper</em>, 2013: <a href="http://www.ma.senac.br/wp-content/uploads/2018/05/ColoredCoinswhitepaper-DigitalAssets.pdf" class="uri">http://www.ma.senac.br/wp-content/uploads/2018/05/ColoredCoinswhitepaper-DigitalAssets.pdf</a>; Vitalik Buterin, <em>A Prehistory of the Ethereum Protocol</em>, September 14, 2017: <a href="https://vitalik.ca/general/2017/09/14/prehistory.html" class="uri">https://vitalik.ca/general/2017/09/14/prehistory.html</a>.</p></div></div></section>
<section id="off-chain-contracts" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="off-chain-contracts">Off-Chain Contracts</h2>
<p>Cryptography allows for the deployment of contracts without them having to be inscribed on-chain. This capability was facilitated by the Schnorr-Taproot upgrade, often simply called “Taproot,” which occurred on BTC on November 14, 2021. It included two major elements: the Schnorr signature scheme and the Taproot contract programming method. These features were integrated as a soft fork within the standard P2TR scheme corresponding to SegWit’s version&nbsp;1.</p>
<p>The Schnorr scheme implemented is a derivation of the authentication protocol described in 1989 by Claus-Peter Schnorr. It is an alternative to ECDSA, based on the same elliptic curve (secp256k1), and allows transactions to be signed using the same key pairs.</p>
<p>Compared to ECDSA, the Schnorr signature scheme has several advantages. First, it produces smaller signatures. Second, the signatures produced are non-malleable, as the procedure doesn’t involve random numbers. Third, and most importantly, it exhibits a property of linearity, enabling functionalities like batch verification and key aggregation.</p>
<p>The Schnorr scheme is superior to ECDSA and existed in 2008, but Satoshi Nakamoto chose not to use it. This choice can be explained by the algorithm being patented in the United States until February 2008, meaning there was no standardized implementation. Bitcoin’s software used OpenSSL, which didn’t include this type of algorithm.</p>
<p>The Schnorr scheme allows the deployment of <em>Scriptless Scripts</em>, contracts “without script” that are executed off-chain and applied within the signatures. The concept was theorized in 2017 by Andrew Poelstra<a href="#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a>. It is found in examples like the MuSig2 multiparty signature scheme, Adaptor Signatures, or Discreet Log Contracts.</p>
<div class="no-row-height column-margin column-container"><div id="fn25"><p><sup>25</sup>&nbsp;Andrew Poelstra, <em>Using the Chain for what Chains are Good For</em> (video), Scaling Bitcoin IV, November 5, 2017: <a href="https://www.youtube.com/watch?v=3pd6xHjLbhs&amp;t=5755s" class="uri">https://www.youtube.com/watch?v=3pd6xHjLbhs&amp;t=5755s</a>; Aaron van Wirdum, “<em>Scriptless Scripts: How Bitcoin Can Support Smart Contracts Without Smart Contracts</em>”, <em>Bitcoin Magazine</em>, November 27, 2017: <a href="https://bitcoinmagazine.com/technical/scriptless-scripts-how-bitcoin-can-support-smart-contracts-without-smart-contracts" class="uri">https://bitcoinmagazine.com/technical/scriptless-scripts-how-bitcoin-can-support-smart-contracts-without-smart-contracts</a>.</p></div></div><p>Moreover, the Schnorr scheme greatly facilitates the implementation of Taproot (BIP-341), which was integrated into the protocol simultaneously. Taproot (literally meaning “taproot” in English) is a method for programming autonomous contracts that anchors the clauses of a contract within a Merkle tree and hides this tree under an aggregated public key belonging to its participants. It allows the contract to be published only in case of dispute and, even then, only the executed conditions are revealed. The scripts used in Taproot employ a programming language called Tapscript (BIP-342), based on Bitcoin’s classic script language.</p>
<p>Taproot relies on a hash tree called a MAST<a href="#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a>, whose leaves are the clauses of the contract—that is, the spending conditions. During MAST execution, the concerned participants need only reveal the applied clause and provide the hashes related to the other clauses (Merkle path), as shown in Figure&nbsp;<a href="#fig:taproot-mast" data-reference-type="ref" data-reference="fig:taproot-mast">13.9</a>. The other spending conditions are thus not revealed.</p>
<div class="no-row-height column-margin column-container"><div id="fn26"><p><sup>26</sup>&nbsp;The acronym MAST originally stands for <em>Merklized Abstract Syntax Trees</em>, referring to data structures described in BIP-114. In Taproot, these aren’t truly abstract syntax trees, but the term remains used. The hash trees in Taproot can be called <em>Merklized Alternative Script Trees</em> by retroacronymy. See Anthony Towns, <em>[bitcoin-dev] Safer sighashes and more granular SIGHASH_NOINPUT</em>, November 23, 2018, 05:03:30 UTC: <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-November/016500.html" class="uri">https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-November/016500.html</a>.</p></div></div><div id="fig:taproot-mast" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/taproot-mast.png" class="img-fluid figure-img"></p>
<figcaption>MAST involving the clauses of a contract.</figcaption>
</figure>
</div>
<p>The implementation of such MASTs within Bitcoin had been proposed in the past, either in the form of a new SegWit version (BIP-114) or a new opcode called <code>OP_MERKLEBRANCHVERIFY</code> (BIP-116, BIP-117). However, Taproot constituted a superior proposal by allowing the MAST’s existence itself to remain hidden.</p>
<p>Indeed, Taproot includes an integrated cooperative spending condition. The internal aggregated public key is slightly modified (<em>tweaked</em>) using the MAST root to account for it. The resulting key is the one recorded in the coin’s locking script, making it indistinguishable from other P2TR outputs. Similarly, the aggregated signature cannot be distinguished from a classic signature. Thus, participants can spend the funds amicably while ensuring that any dispute will lead to on-chain settlement.</p>
<p>An alternative to Taproot is RGB, a system of off-chain autonomous contracts built both on top of Bitcoin and Lightning. The name comes from the RGB standard (<em>Red Green Blue</em>), which is used to define a color, directly referencing colored coins, as RGB was originally conceived as “a better version of colored coins<a href="#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a>.” However, while RGB indeed allows the issuance and management of tokens, this functionality is far from the only one.</p>
<div class="no-row-height column-margin column-container"><div id="fn27"><p><sup>27</sup>&nbsp;RGB FAQ, <em>What does ‘RGB’ stand for?</em>, December 14, 2020: <a href="https://www.rgbfaq.com/faq/what-does-rgb-stand-for" class="uri">https://www.rgbfaq.com/faq/what-does-rgb-stand-for</a>.</p></div></div><p>RGB is based on two technical primitives conceptualized in 2016 by developer Peter Todd: client-side validation and single-use seals. This allows the management of an independent state where double-spending is prevented by these seals. After research by Giacomo Zucco and the BHB Network, RGB is currently developed by the LNP/BP Standards Association.</p>
<p>Implementing contracts off-chain is thus possible on Bitcoin, bringing two main benefits. First, it reduces fee payments by having a minimal on-chain footprint. Second, it improves the privacy of participants. This potential positions them to play a significant role in the long term.</p>
</section>
<section id="a-programmable-currency" class="level2 unnumbered page-columns page-full">
<h2 class="unnumbered anchored" data-anchor-id="a-programmable-currency">A Programmable Currency</h2>
<p>The programmable aspect of Bitcoin is often overlooked. It’s not directly presented in the white paper, even though Satoshi Nakamoto had already developed it by then. However, it’s very useful and constitutes one of Bitcoin’s essential facets.</p>
<p>Currency programmability can be used for control, as illustrated by the CBDC projects emerging worldwide. But it can also greatly enhance individual freedom. This modular aspect allows people who don’t know each other to exchange value in the most secure way possible or, as Tim May expressed in his <em>Crypto Anarchist Manifesto</em> of 1988, to “do business and negotiate contracts electronically with strangers, without ever knowing the True Name, or legal identity, of the other<a href="#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a>.”</p>
<div class="no-row-height column-margin column-container"><div id="fn28"><p><sup>28</sup>&nbsp;Timothy C. May, <em>The Crypto Anarchist Manifesto</em>, November 22, 1992, 20:11:24 UTC: <a href="https://cypherpunks.venona.com/date/1992/11/msg00204.html" class="uri">https://cypherpunks.venona.com/date/1992/11/msg00204.html</a>.</p></div></div><p>Autonomous contracts form the cornerstone of financial relations in cyberspace. Even the Monero community, which had particularly restricted this aspect for privacy reasons, retraced its steps by integrating multisignature functionality into the protocol, notably to allow atomic swaps. A truly free currency must be freely programmable.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/les-rouages-de-la-machine.html" class="pagination-link" aria-label="The Inner Workings of the Machine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Inner Workings of the Machine</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/le-passage-a-l-echelle.html" class="pagination-link" aria-label="Scaling Up">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling Up</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2024 Konsensus Network
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../index.html">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../presale.html">
<p>Acheter</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/konsensusn">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/konsensusnetwork">
      <i class="bi bi-github" role="img" aria-label="Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/konsensusnetwork">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/konsensusnetwork">
      <i class="bi bi-youtube" role="img" aria-label="YouTube">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>