% Copyright (c) 2023 Ludovic Lars
% This work is licensed under the CC BY-NC-SA 4.0 International License

\documentclass[a5paper, 10pt, twoside, openright, extrafontsizes]{memoir}

% Basic packages
\usepackage[polutonikogreek, french]{babel} % language
\usepackage[utf8]{inputenc}                 % accents
\usepackage[T1]{fontenc}                    % french characters
\usepackage[
    left=17mm,
    right=17mm,
    top=10mm,
    bottom=4mm,
    bindingoffset=6mm,
    includeheadfoot
]{geometry}           % margin 
\usepackage{setspace}                       % spacing
\usepackage{graphicx}                       % images
\usepackage[font=small]{caption}            % custom caption
\usepackage{verbatim}                       % preformatted text
\usepackage{enumerate}                      % lists
\usepackage[hidelinks=true]{hyperref}                       % cross-referencing
\usepackage{xurl}
\usepackage{enotez}                         % endnotes
\NewSplitTitleTag{title}{\nameref{enotezch:<split-level-id>}}
\setenotez{list-name=Notes, backref=true, totoc=chapter, reset=true, split=chapter, split-title={\chaptername\ <ref> -- <title>}}

\usepackage[style=verbose-ibid, backend=biber, sorting=nty, dashed=false]{biblatex}
\setlength\bibitemsep{0.64\baselineskip}
\DeclareNameAlias{sortname}{last-first}

%change bibliography font size
\renewcommand*{\bibfont}{\normalfont}
%\renewcommand{\footnotesize}{\scriptsize}

\usepackage{lettrine}
\setcounter{DefaultLines}{3}
\renewcommand{\DefaultLoversize}{0.1}
\renewcommand{\DefaultLraise}{0}
\renewcommand{\LettrineTextFont}{}
\setlength{\DefaultFindent}{\fontdimen2\font}
\setlength{\DefaultNindent}{0em}

% Custom packages
\usepackage{newtxtext}                      % Times New Roman font
\usepackage{eurosym}                        % euro symbol
\usepackage{amsfonts,amsmath,amssymb,amsthm}    % math
\usepackage{xcolor}
\usepackage{fancyvrb}                       % fancy verbatim
\usepackage{seqsplit}
\usepackage{csquotes}
%\usepackage[page]{pagenote}                 % pagenotes

\usepackage[type={CC}, modifier={by-nc-sa}, version={4.0}]{doclicense} % license

% Custom settings
\setlength{\parskip}{1ex}                   % paragraph spacing
\renewenvironment{quote}{\small\list{}{\topsep=0.5\baselineskip}\item\relax}{\endlist} % quote spacing
\renewcommand{\arraystretch}{1.3}           % tabular spacing
\renewcommand\frenchtablename{Tableau}      % French name for table
\makepagenote
\renewcommand{\notenumintext}[1]{} % no mark for pagenotes
\renewcommand{\notenuminnotes}[1]{} % no number in pagenotes
\renewcommand{\notesname}{Notes supplémentaires} % pagenote chapter title
\renewcommand{\notedivision}{\chapter*{\notesname}} % remove pagenote chapter from toc

% Custom commands
\newcommand{\eng}[1]{{\NoAutoSpaceBeforeFDP\emph{#1}}}  % english
\newcommand{\wtime}[1]{{#1}}       % datetime
\newcommand{\longstring}[1]{\texttt{\NoAutoSpaceBeforeFDP\seqsplit{#1}}}
%\newcommand{\footnote}{\,\endnote}
\newcommand{\versionNumber}{1.2.0}

\addbibresource{back/bibliography.bib}

\title{L'Élégance de Bitcoin} 
\newcommand{\subtitle}{Histoire, enjeux et principes}

\author{Ludovic Lars}
\date{\today}
\newcommand{\press}{Konsensus Network}
\newcommand{\ISBNEBOOK}{978-9916-723-63-0}
\newcommand{\ISBNSC}{978-9916-723-62-3}
\newcommand{\ISBNHC}{978-9916-723-61-6}
\newcommand{\editor}{
\textbf{Editor}\\
Who is the editor?\\
}

\hypersetup{ 
    pdftitle={\csname @title\endcsname},
    pdfauthor={\csname @author\endcsname}
}


% custom title page
\thispagestyle{empty}
\makeatletter
\newlength\drop
\newcommand*\fulltitlepage{\begingroup
\setlength\drop{0.15\textheight}
\begin{center}
\vspace*{\drop}
\rule{\textwidth}{0in}\par
\vspace{-40pt}
{\HUGE\textbf\thetitle\par}
\vspace{10mm}
{\Large\textsc\subtitle\par}
\vspace{10mm}
\rule{7cm}{0.3mm}\par
\vspace{10mm}
{\Large\textbf{\textit\theauthor}\par}
\vspace{20mm}
\vfill
\vspace{0.5\baselineskip}
\includegraphics[width=3.5cm]{img/knw}\par

\end{center}
\endgroup}
\makeatother

% custom second title page
\thispagestyle{empty}
\makeatletter
\newcommand*\halftitlepage{\begingroup
 \setlength\drop{0.1\textheight}
 \begin{center}
 \vspace*{\drop}
 \rule{\textwidth}{0in}\par
 {\Large\textsc\thetitle\par}
 \rule{\textwidth}{0in}\par
 \vfill
 \end{center}
\endgroup}
\makeatother

% Titles
\usepackage{titlesec}

\titleformat
{\chapter}
[display]
{\normalfont\scshape\huge}
{\HUGE\thechapter\centering}
{0pt}
{\vspace{18pt}\centering}[\vspace{42pt}]

\titleformat{\section}[block]{\bfseries\Large}{}{0pt}{}[]
\titleformat{\subsection}[block]{\itshape}{}{0pt}{\centering}[]
\titlespacing*{\section}{0pt}{2em}{0.5em}

% Pagestyles
  % for normal pages
\nouppercaseheads
\headsep = 6mm
\makepagestyle{mystyle} 
%\setlength{\headwidth}{\dimexpr\textwidth+\marginparsep+\marginparwidth\relax}
%\makerunningwidth{mystyle}{\headwidth}
\makeevenhead{mystyle}{\small\thepage}{{\small\MakeUppercase{L'Élégance de Bitcoin}}}{}
\makeoddhead{mystyle}{}{{\small\MakeUppercase{\leftmark}}}{\small\thepage}
\makeevenfoot{mystyle}{}{{}}{}
\makeoddfoot{mystyle}{}{{}}{}
\makeatletter
\makepsmarks{mystyle}{%
\createmark{chapter}{left}{nonumber}{\@chapapp\ }{.\ }}
\makeatother
% for pages where chapters begin
\makepagestyle{plain}
\makerunningwidth{plain}{\headwidth}
\makeevenfoot{plain}{}{{}}{}
\makeoddfoot{plain}{}{{}}{}
\pagestyle{mystyle}

% table of contents customisation
\usepackage[]{tocloft}
\renewcommand{\cftsectiondotsep}{\cftnodots}
\renewcommand{\cftpartfont}{\Large\bfseries\MakeUppercase}


\renewcommand{\cftchapterpresnum}{CHAPITRE~}
\renewcommand{\cftchapternumwidth}{8em}
\setlength{\cftsectionindent}{8em}
\setsecnumdepth{chapter}

\setlength{\parskip}{0em}
\linespread{1.08}

\begin{document}


% \maketitle

% \thispagestyle{empty}
% \doclicenseThis
\pagestyle{empty}
\frontmatter
\halftitlepage
\cleardoublepage
\fulltitlepage
\clearpage

% copyright page
\begin{center}
\end{center}
\vfill
\scriptsize
\noindent \copyright\space 2023 \theauthor

\vspace{0.25\baselineskip}

\noindent \textit{\thetitle : \subtitle}

\vspace{1\baselineskip}

\noindent Version: v1.3.0

\vspace{1\baselineskip}

\noindent Cette œuvre est mise à disposition selon les termes de la licence CC BY-SA 4.0. \\ Une copie de cette licence se trouve à l'adresse \\ \url{http://creativecommons.org/licenses/by-sa/4.0/}

\vspace{0.5\baselineskip}

\noindent Typesetting: \press

\vspace{0.5\baselineskip}

\noindent Conception de la couverture: ImTechnicolor

\vspace{1\baselineskip}

\noindent ISBN \ISBNHC \:Hardcover

\hspace{0.20\parindent}\ISBNSC \:Paperback

\hspace{0.20\parindent}\ISBNEBOOK \:Ebook

\vspace{1\baselineskip}

\noindent {\Large \scshape{\press }}
\includegraphics[width=0.5cm]{img/free_starfish.png} \space\url{https://konsensus.network}

\normalsize
\clearpage

% custom dedication
\makeatletter
\newcommand*\dedication{\begingroup
 \setlength\drop{0.1\textheight}
 \begin{center}
 \vspace*{\drop}
    \itshape{\noindent{« Messieurs, s'écria-t-il d'une voix sonore qui s'adressait à tous, le prince affirme que la beauté sauvera le monde ! »\par
    \vspace{3em}
    Fiodor M. Dostoïevski,\par
    L'Idiot}}
 \vfill
 \end{center}
\endgroup}
\makeatother

\dedication
\cleardoublepage

\pagestyle{mystyle}

\include{front/foreword}
\include{front/acknowledgements}
\include{front/preface}

\pagestyle{empty}
\tableofcontents
%\addcontentsline{toc}{chapter}{Table des matières}

\mainmatter


\pagestyle{mystyle}
\include{chapters/ch01-mythe}
% End notes
\AtNextEndnotesList{\footnotesize La rédaction initiale de cet ouvrage s'est terminée le 30 novembre 2023. Les traductions des textes en anglais sont celles de l'auteur, hormis quand le titre français est précisé en note. Les dates et heures sont données selon le fuseau UTC, sauf indication contraire. Des notes supplémentaires peuvent être retrouvées à l'adresse \url{https://viresinnumeris.fr/bitcoinelegancenotes-v1-3-0.pdf}. Cette édition (v1.3.0, janvier 2025) contient de multiples corrections, de nouvelles notes et des améliorations de traduction.\par}
%\printendnotes

\include{chapters/ch02-clivages}
%\printendnotes
\include{chapters/ch03-monnaie}
%\printendnotes
\include{chapters/ch04-adversaire}
%\printendnotes
\include{chapters/ch05-cypherpunks}
%\printendnotes
\include{chapters/ch06-cybermonnaie}
%\printendnotes

% \part{Quoi ?}

\include{chapters/ch07-propriete}
%\printendnotes
\include{chapters/ch08-confirmation}
%\printendnotes
\include{chapters/ch09-censure}
%\printendnotes
\include{chapters/ch10-changement}
%\printendnotes
\include{chapters/ch11-determination}
%\printendnotes

% \part{Comment ?}

\include{chapters/ch12-rouages}
%\printendnotes
\include{chapters/ch13-contrats}
%\printendnotes
\include{chapters/ch14-scalabilite}
%\printendnotes
\include{chapters/ch15-avenir}

\backmatter
\pagestyle{empty}
\printendnotes

% Bibliography
\nocite{*}
\printbibliography[title=Bibliographie, heading=bibintoc]

% Page notes
%{\footnotesize \printnotes}
\include{appendix/ordinals}

\end{document}